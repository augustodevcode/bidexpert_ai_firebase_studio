// prisma/models/lot.prisma
import { LotStatus, Asset, Auction, User, Bid, UserLotMaxBid, Review, LotQuestion, Tenant, Seller, Auctioneer, LotCategory, Subcategory, LotStagePrice, InstallmentPayment, AssetsOnLots } from "./";

model Lot {
  id                  BigInt   @id @default(autoincrement())
  publicId            String   @unique @default(cuid())
  tenantId            String
  auctionId           BigInt
  number              String?
  title               String
  description         String?  @db.Text
  properties          Json?
  
  status              LotStatus @default(EM_BREVE)
  
  price               Decimal   @db.Decimal(12, 2)
  initialPrice        Decimal?  @db.Decimal(12, 2)
  secondInitialPrice  Decimal?  @db.Decimal(12, 2)
  bidIncrementStep    Decimal?  @db.Decimal(12, 2)
  evaluationValue     Decimal?  @db.Decimal(12, 2)

  views               Int       @default(0)
  bidsCount           Int       @default(0)
  
  hasKey              Boolean   @default(true)
  canBeVisited        Boolean   @default(true)
  
  street              String?
  numberAddress       String?
  complement          String?
  neighborhood        String?
  zipCode             String?
  latitude            Decimal?  @db.Decimal(10, 8)
  longitude           Decimal?  @db.Decimal(11, 8)
  
  imageUrl            String?
  imageMediaId        String?
  inheritedMediaFromAssetId String? // ID do Asset de onde a m√≠dia foi herdada
  
  isFeatured          Boolean   @default(false)
  isExclusive         Boolean   @default(false)
  
  winnerId            String?
  winningBidTermUrl   String?

  additionalTriggers  String[]
  dataAiHint          String?

  isRelisted          Boolean?  @default(false)
  relistCount         Int?      @default(0)

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  auction             Auction   @relation(fields: [auctionId], references: [id])
  winner              User?     @relation("WonLots", fields: [winnerId], references: [id])
  bids                Bid[]
  userMaxBids         UserLotMaxBid[]
  reviews             Review[]
  questions           LotQuestion[]
  tenant              Tenant    @relation(fields: [tenantId], references: [id])
  
  seller              Seller?   @relation(fields: [sellerId], references: [id])
  sellerId            BigInt?
  auctioneer          Auctioneer? @relation(fields: [auctioneerId], references: [id])
  auctioneerId        BigInt?
  
  category            LotCategory @relation(fields: [categoryId], references: [id])
  categoryId          BigInt
  subcategory         Subcategory? @relation(fields: [subcategoryId], references: [id])
  subcategoryId       BigInt?

  cityId              BigInt?
  stateId             BigInt?
  
  assets              AssetsOnLots[]
  stageDetails        LotStagePrice[]
  wins                UserWin[]
  installmentPayments InstallmentPayment[]
  originalLot         Lot?      @relation("RelistedLot", fields: [originalLotId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  originalLotId       BigInt?   @unique
  relistedLot         Lot?      @relation("RelistedLot")

  @@index([auctionId])
  @@index([status])
  @@index([winnerId])
}
