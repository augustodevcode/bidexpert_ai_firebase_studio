// prisma/models/Lot.prisma
model Lot {
  id                       String             @id @default(cuid())
  publicId                 String?            @unique
  number                   String?
  title                    String
  description              String?            @db.Text
  properties               String?            @db.Text
  price                    Decimal            @db.Decimal(12, 2)
  initialPrice             Decimal?           @db.Decimal(12, 2)
  secondInitialPrice       Decimal?           @db.Decimal(12, 2)
  bidIncrementStep         Decimal?           @db.Decimal(12, 2)
  status                   LotStatus          @default(EM_BREVE)
  bidsCount                Int?               @default(0)
  views                    Int?               @default(0)
  isFeatured               Boolean?           @default(false)
  isExclusive              Boolean?           @default(false)
  allowInstallmentBids     Boolean?           @default(true)
  imageUrl                 String?
  imageMediaId             String?
  galleryImageUrls         Json?
  inheritedMediaFromAssetId String?
  dataAiHint               String?
  
  street           String?
  number           String?
  complement       String?
  neighborhood     String?
  zipCode          String?
  latitude         Decimal? @db.Decimal(10, 8)
  longitude        Decimal? @db.Decimal(11, 8)
  mapAddress       String?
  
  hasKey                   Boolean?           @default(false)
  
  year                     Int?
  make                     String?
  model                    String?
  version                  String?
  odometer                 Int?
  transmissionType         String?
  
  evaluationValue          Decimal?           @db.Decimal(12, 2)
  reservePrice             Decimal?           @db.Decimal(12, 2)
  debtAmount               Decimal?           @db.Decimal(12, 2)
  itbiValue                Decimal?           @db.Decimal(12, 2)
  
  publicProcessUrl         String?
  judicialProcessNumber    String?
  courtDistrict            String?
  courtName                String?
  propertyRegistrationNumber String?
  propertyLiens            String?            @db.Text
  knownDebts               String?            @db.Text
  additionalDocumentsInfo  String?            @db.Text

  winningBidTermUrl        String?
  
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  
  auctionId                String
  auction                  Auction            @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  
  type                     String
  categoryId               String?
  category                 LotCategory?       @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  subcategoryId            String?
  subcategory              Subcategory?       @relation(fields: [subcategoryId], references: [id], onDelete: SetNull)

  assets                   AssetsOnLots[]
  bids                     Bid[]
  winner                   User?              @relation("WonLots", fields: [winnerId], references: [id], onDelete: SetNull)
  winnerId                 String?
  wins                     UserWin[]
  reviews                  Review[]
  questions                LotQuestion[]
  maxBids                  UserLotMaxBid[]
  
  sellerId                 String?
  seller                   Seller?            @relation(fields: [sellerId], references: [id])
  
  auctioneerId             String?
  auctioneer               Auctioneer?        @relation(fields: [auctioneerId], references: [id])
  
  stateId                  String?
  state                    State?             @relation(fields: [stateId], references: [id])
  
  cityId                   String?
  city                     City?              @relation(fields: [cityId], references: [id])

  isRelisted               Boolean?           @default(false)
  relistCount              Int?               @default(0)
  originalLot              Lot?               @relation("RelistHistory", fields: [originalLotId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  originalLotId            String?            @unique
  relistedLots             Lot[]              @relation("RelistHistory")

  stageDetails             LotStageDetails[]
  
  tenantId                 String
  tenant                   Tenant             @relation(fields: [tenantId], references: [id])

  @@index([auctionId, number])
}
