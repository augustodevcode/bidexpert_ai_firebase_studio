// prisma/models/lot.prisma
model Lot {
  id              String   @id @default(cuid())
  publicId        String   @unique @default(uuid())
  number          String?
  title           String
  description     String?  @db.Text
  status          String   @default("EM_BREVE")
  auctionId       String
  auction         Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  price           Decimal  @db.Decimal(15, 2)
  initialPrice    Decimal? @db.Decimal(15, 2)
  evaluationValue Decimal? @db.Decimal(15, 2)

  views     Int  @default(0)
  bidsCount Int  @default(0)
  bids      Bid[]

  isFeatured  Boolean @default(false)
  isExclusive Boolean @default(false)

  imageUrl       String?
  imageMediaId   String?
  galleryImageUrls Json?
  mediaItemIds   Json?

  categoryId    String?
  category      LotCategory?  @relation(fields: [categoryId], references: [id])
  subcategoryId String?
  subcategory   Subcategory?  @relation(fields: [subcategoryId], references: [id])
  type          String // Denormalized from category for easier filtering

  sellerId    String?
  seller      Seller?       @relation(fields: [sellerId], references: [id])
  auctioneerId String?
  auctioneer  Auctioneer?   @relation(fields: [auctioneerId], references: [id])
  
  // Location
  cityName      String?
  stateUf       String?
  cityId        String?
  stateId       String?
  latitude      Decimal? @db.Decimal(10, 8)
  longitude     Decimal? @db.Decimal(11, 8)
  mapAddress    String?

  endDate     DateTime?
  auctionDate DateTime?

  // Lógica de Praças/Etapas
  stageDetails Json? @default("[]")

  // Relist Logic
  originalLotId String?
  isRelisted    Boolean @default(false)
  relistCount   Int     @default(0)

  // Winner Info
  winnerId          String?
  winner            User?             @relation("LotWinner", fields: [winnerId], references: [id], onDelete: SetNull)
  winningBidTermUrl String?
  wins              UserWin[]

  // Auditing
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  bens LotBens[]
  
  inheritedMediaFromBemId String?

  @@index([auctionId])
  @@index([winnerId])
  @@index([sellerId])
  @@index([status])
  @@index([tenantId])
}
