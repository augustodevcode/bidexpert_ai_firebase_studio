generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  BigInt                 @id @default(autoincrement())
  email               String                 @unique
  password            String?                @db.Text
  fullName            String?                @db.Text
  cpf                 String?                @db.Text
  rgNumber            String?                @db.Text
  rgIssuer            String?                @db.Text
  rgIssueDate         DateTime?
  dateOfBirth         DateTime?
  cellPhone           String?                @db.Text
  homePhone           String?                @db.Text
  gender              String?                @db.Text
  profession          String?                @db.Text
  nationality         String?                @db.Text
  maritalStatus       String?                @db.Text
  propertyRegime      String?                @db.Text
  spouseName          String?                @db.Text
  spouseCpf           String?                @db.Text
  zipCode             String?                @db.Text
  street              String?                @db.Text
  number              String?                @db.Text
  complement          String?                @db.Text
  neighborhood        String?                @db.Text
  city                String?                @db.Text
  state               String?                @db.Text
  avatarUrl           String?                @db.Text
  dataAiHint          String?                @db.Text
  habilitationStatus  UserHabilitationStatus @default(PENDING_DOCUMENTS)
  accountType         AccountType            @default(PHYSICAL)
  badges              Json?
  razaoSocial         String?                @db.Text
  cnpj                String?                @db.Text
  inscricaoEstadual   String?                @db.Text
  website             String?                @db.Text
  responsibleName     String?                @db.Text
  responsibleCpf      String?                @db.Text
  optInMarketing      Boolean?               @default(false)
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  habilitations       AuctionHabilitation[]
  auctioneers         Auctioneer?
  bids                Bid[]
  lotsWon             Lot[]                  @relation("LotsWon")
  questions           LotQuestion[]
  createdMedia        MediaItem[]            @relation("UploadedBy")
  notifications       Notification[]
  createdReports      Report[]               @relation("CreatedBy")
  reviews             Review[]
  sellers             Seller?
  documents           UserDocument[]
  maxBids             UserLotMaxBid[]
  wins                UserWin[]
  roles               UsersOnRoles[]
  tenants             UsersOnTenants[]
  auditLogs           AuditLog[]
  bidderProfile       BidderProfile?
  formSubmissions     FormSubmission[]
  itsmAttachments     ITSM_Attachment[]
  itsmChatLogs        ITSM_ChatLog[]
  itsmMessages        ITSM_Message[]
  itsmQueryLogs       ITSM_QueryLog[]
  itsmAssignedTickets ITSM_Ticket[]          @relation("ITSM_AssignedTickets")
  itsmTickets         ITSM_Ticket[]
  assetOccupationUpdates Asset[]             @relation("AssetOccupationUpdater")
  verifiedLotRisks     LotRisk[]             @relation("LotRiskVerifiedBy")
}

model Role {
  id             BigInt         @id @default(autoincrement())
  name           String         @unique
  nameNormalized String         @unique
  description    String?
  permissions    Json?
  users          UsersOnRoles[]
}

model UsersOnRoles {
  userId     BigInt
  roleId     BigInt
  assignedAt DateTime @default(now())
  assignedBy String
  role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([roleId])
}

model Tenant {
  id                     BigInt                 @id @default(autoincrement())
  name                   String
  subdomain              String                 @unique
  domain                 String?                @unique
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt
  assets                 Asset[]
  assetMedia             AssetMedia[]
  assetsOnLots           AssetsOnLots[]
  auctions               Auction[]
  auctionHabilitations   AuctionHabilitation[]
  auctionStages          AuctionStage[]
  auctioneers            Auctioneer[]
  bids                   Bid[]
  DirectSaleOffer        DirectSaleOffer[]
  installmentPayments    InstallmentPayment[]
  judicialParties        JudicialParty[]
  processes              JudicialProcess[]
  lots                   Lot[]
  lotCategories          LotCategory[]
  lotDocuments           LotDocument[]
  lotQuestions           LotQuestion[]
  lotStagePrices         LotStagePrice[]
  lotRisks               LotRisk[]
  mediaItems             MediaItem[]
  notifications          Notification[]
  settings               PlatformSettings?
  reports                Report[]
  reviews                Review[]
  sellers                Seller[]
  subcategories          Subcategory[]
  subscribers            Subscriber[]
  userDocuments          UserDocument[]
  userLotMaxBids         UserLotMaxBid[]
  userWins               UserWin[]
  users                  UsersOnTenants[]
  auditLogs              AuditLog[]
  bidderNotifications    BidderNotification[]
  bidderProfiles         BidderProfile[]
  formSubmissions        FormSubmission[]
  itsmChatLogs           ITSM_ChatLog[]
  itsmTickets            ITSM_Ticket[]
  participationHistories ParticipationHistory[]
  paymentMethods         PaymentMethod[]
  wonLots                WonLot[]
}

model UsersOnTenants {
  userId     BigInt
  tenantId   BigInt
  assignedAt DateTime @default(now())
  assignedBy String?
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, tenantId])
  @@index([tenantId])
}

model Lot {
  id                       BigInt               @id @default(autoincrement())
  publicId                 String?              @unique
  auctionId                BigInt
  number                   String?
  title                    String
  description              String?              @db.Text
  slug                     String?
  price                    Decimal              @db.Decimal(15, 2)
  initialPrice             Decimal?             @db.Decimal(15, 2)
  secondInitialPrice       Decimal?             @db.Decimal(15, 2)
  bidIncrementStep         Decimal?             @db.Decimal(10, 2)
  status                   LotStatus            @default(EM_BREVE)
  bidsCount                Int?                 @default(0)
  views                    Int?                 @default(0)
  isFeatured               Boolean?             @default(false)
  isExclusive              Boolean?             @default(false)
  discountPercentage       Int?
  additionalTriggers       Json?
  imageUrl                 String?              @db.Text
  imageMediaId             BigInt?
  galleryImageUrls         Json?
  mediaItemIds             Json?
  stageDetails             Json?
  type                     String
  condition                String?
  dataAiHint               String?
  winnerId                 BigInt?
  winningBidTermUrl        String?
  allowInstallmentBids     Boolean?             @default(false)
  isRelisted               Boolean              @default(false)
  relistCount              Int                  @default(0)
  original_lot_id          BigInt?              @unique
  createdAt                DateTime             @default(now())
  updatedAt                DateTime             @updatedAt
  endDate                  DateTime?
  lotSpecificAuctionDate   DateTime?
  secondAuctionDate        DateTime?
  categoryId               BigInt?
  subcategoryId            BigInt?
  sellerId                 BigInt?
  auctioneerId             BigInt?
  cityId                   BigInt?
  stateId                  BigInt?
  cityName                 String?
  stateUf                  String?
  latitude                 Decimal?
  longitude                Decimal?
  mapAddress               String?
  tenantId                 BigInt
  depositGuaranteeAmount   Decimal?             @db.Decimal(15, 2)
  depositGuaranteeInfo     String?              @db.Text
  requiresDepositGuarantee Boolean?             @default(false)
  assets                   AssetsOnLots[]
  bids                     Bid[]
  auction                  Auction              @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  auctioneer               Auctioneer?          @relation(fields: [auctioneerId], references: [id])
  category                 LotCategory?         @relation(fields: [categoryId], references: [id])
  city                     City?                @relation(fields: [cityId], references: [id])
  originalLot              Lot?                 @relation("RelistedLot", fields: [original_lot_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  relistedLot              Lot?                 @relation("RelistedLot")
  seller                   Seller?              @relation(fields: [sellerId], references: [id])
  state                    State?               @relation(fields: [stateId], references: [id])
  subcategory              Subcategory?         @relation(fields: [subcategoryId], references: [id])
  tenant                   Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  winner                   User?                @relation("LotsWon", fields: [winnerId], references: [id])
  documents                LotDocument[]
  questions                LotQuestion[]
  lotPrices                LotStagePrice[]
  Notification             Notification[]
  reviews                  Review[]
  maxBids                  UserLotMaxBid[]
  wins                     UserWin?
  payments                 InstallmentPayment[] @relation("InstallmentPaymentToLot")
  judicialProcesses        JudicialProcess[]    @relation("JudicialProcessToLot")
  lotRisks                 LotRisk[]

  @@unique([auctionId, number])
  @@index([auctioneerId])
  @@index([categoryId])
  @@index([cityId])
  @@index([sellerId])
  @@index([stateId])
  @@index([subcategoryId])
  @@index([tenantId])
  @@index([winnerId])
}

model Asset {
  id                         BigInt           @id @default(autoincrement())
  publicId                   String           @unique
  title                      String
  description                String?          @db.Text
  status                     AssetStatus      @default(DISPONIVEL)
  categoryId                 BigInt?
  subcategoryId              BigInt?
  judicialProcessId          BigInt?
  sellerId                   BigInt?
  evaluationValue            Decimal?         @db.Decimal(15, 2)
  imageUrl                   String?
  imageMediaId               BigInt?
  galleryImageUrls           Json?
  mediaItemIds               Json?
  dataAiHint                 String?
  locationCity               String?
  locationState              String?
  address                    String?
  latitude                   Decimal?
  longitude                  Decimal?
  createdAt                  DateTime         @default(now())
  updatedAt                  DateTime         @updatedAt
  tenantId                   BigInt
  plate                      String?
  make                       String?
  model                      String?
  version                    String?
  year                       Int?
  modelYear                  Int?
  mileage                    Int?
  color                      String?
  fuelType                   String?
  transmissionType           String?
  bodyType                   String?
  vin                        String?          @unique
  renavam                    String?          @unique
  enginePower                String?
  numberOfDoors              Int?
  vehicleOptions             String?          @db.Text
  detranStatus               String?          @db.Text
  debts                      String?          @db.Text
  runningCondition           String?
  bodyCondition              String?
  tiresCondition             String?
  hasKey                     Boolean?
  propertyRegistrationNumber String?
  iptuNumber                 String?
  isOccupied                 Boolean?
  occupationStatus           OccupationStatus?
  occupationNotes            String?          @db.Text
  occupationLastVerified     DateTime?
  occupationUpdatedBy        BigInt?
  totalArea                  Decimal?
  builtArea                  Decimal?
  bedrooms                   Int?
  suites                     Int?
  bathrooms                  Int?
  parkingSpaces              Int?
  constructionType           String?
  finishes                   String?          @db.Text
  infrastructure             String?          @db.Text
  condoDetails               String?          @db.Text
  improvements               String?          @db.Text
  topography                 String?
  liensAndEncumbrances       String?          @db.Text
  propertyDebts              String?          @db.Text
  unregisteredRecords        String?          @db.Text
  hasHabiteSe                Boolean?
  zoningRestrictions         String?
  amenities                  Json?
  brand                      String?
  serialNumber               String?
  itemCondition              String?
  specifications             String?          @db.Text
  includedAccessories        String?          @db.Text
  batteryCondition           String?
  hasInvoice                 Boolean?
  hasWarranty                Boolean?
  repairHistory              String?          @db.Text
  applianceCapacity          String?
  voltage                    String?
  applianceType              String?
  additionalFunctions        String?
  hoursUsed                  Int?
  engineType                 String?
  capacityOrPower            String?
  maintenanceHistory         String?          @db.Text
  installationLocation       String?
  compliesWithNR             String?
  operatingLicenses          String?
  breed                      String?
  age                        String?
  sex                        String?
  weight                     String?
  individualId               String?
  purpose                    String?
  sanitaryCondition          String?          @db.Text
  lineage                    String?
  isPregnant                 Boolean?
  specialSkills              String?
  gtaDocument                String?
  breedRegistryDocument      String?
  furnitureType              String?
  material                   String?
  style                      String?
  dimensions                 String?
  pieceCount                 Int?
  jewelryType                String?
  metal                      String?
  gemstones                  String?
  totalWeight                String?
  jewelrySize                String?
  authenticityCertificate    String?
  workType                   String?
  artist                     String?
  period                     String?
  technique                  String?
  provenance                 String?          @db.Text
  boatType                   String?
  boatLength                 String?
  hullMaterial               String?
  onboardEquipment           String?          @db.Text
  productName                String?
  quantity                   String?
  packagingType              String?
  expirationDate             DateTime?
  storageConditions          String?
  preciousMetalType          String?
  purity                     String?
  forestGoodsType            String?
  volumeOrQuantity           String?
  species                    String?
  dofNumber                  String?
  category                   LotCategory?     @relation(fields: [categoryId], references: [id])
  judicialProcess            JudicialProcess? @relation(fields: [judicialProcessId], references: [id])
  seller                     Seller?          @relation(fields: [sellerId], references: [id])
  subcategory                Subcategory?     @relation(fields: [subcategoryId], references: [id])
  tenant                     Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  occupationUpdatedByUser    User?            @relation("AssetOccupationUpdater", fields: [occupationUpdatedBy], references: [id])
  gallery                    AssetMedia[]
  lots                       AssetsOnLots[]

  @@index([categoryId])
  @@index([judicialProcessId])
  @@index([sellerId])
  @@index([subcategoryId])
  @@index([tenantId])
}

model AssetsOnLots {
  lotId      BigInt
  assetId    BigInt
  assignedAt DateTime @default(now())
  assignedBy String
  tenantId   BigInt
  asset      Asset    @relation(fields: [assetId], references: [id])
  lot        Lot      @relation(fields: [lotId], references: [id])
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@id([lotId, assetId])
  @@index([tenantId])
  @@index([assetId])
}

model Auction {
  id                       BigInt                @id @default(autoincrement())
  publicId                 String?               @unique
  slug                     String?               @unique
  title                    String
  description              String?               @db.Text
  status                   AuctionStatus         @default(RASCUNHO)
  auctionDate              DateTime?
  endDate                  DateTime?
  totalLots                Int                   @default(0)
  visits                   Int                   @default(0)
  totalHabilitatedUsers    Int                   @default(0)
  initialOffer             Decimal?              @db.Decimal(15, 2)
  auctionType              AuctionType?
  auctionMethod            AuctionMethod?        @default(STANDARD)
  participation            AuctionParticipation? @default(ONLINE)
  onlineUrl                String?               @db.VarChar(500)
  address                  String?
  zipCode                  String?               @db.VarChar(10)
  latitude                 Decimal?              @db.Decimal(10, 8)
  longitude                Decimal?              @db.Decimal(11, 8)
  documentsUrl             String?               @db.VarChar(500)
  isFeaturedOnMarketplace  Boolean               @default(false)
  softCloseEnabled         Boolean?              @default(false)
  softCloseMinutes         Int?
  achievedRevenue          Decimal?              @db.Decimal(15, 2)
  evaluationReportUrl      String?               @db.VarChar(500)
  auctionCertificateUrl    String?               @db.VarChar(500)
  floorPrice               Decimal?              @db.Decimal(15, 2)
  decrementAmount          Decimal?              @db.Decimal(10, 2)
  decrementIntervalSeconds Int?
  sellingBranch            String?
  additionalTriggers       Json?
  createdAt                DateTime              @default(now())
  updatedAt                DateTime              @updatedAt
  tenantId                 BigInt
  auctioneerId             BigInt?
  sellerId                 BigInt?
  imageMediaId             BigInt?
  isRelisted               Boolean               @default(false)
  relistCount              Int                   @default(0)
  originalAuctionId        BigInt?               @unique
  cityId                   BigInt?
  stateId                  BigInt?
  judicialProcessId        BigInt?
  categoryId               BigInt?
  complement               String?               @db.VarChar(100)
  neighborhood             String?               @db.VarChar(100)
  number                   String?               @db.VarChar(20)
  street                   String?               @db.VarChar(255)
  auctioneer               Auctioneer?           @relation(fields: [auctioneerId], references: [id])
  category                 LotCategory?          @relation(fields: [categoryId], references: [id])
  cityRef                  City?                 @relation("CityAuctions", fields: [cityId], references: [id])
  judicialProcess          JudicialProcess?      @relation(fields: [judicialProcessId], references: [id])
  originalAuction          Auction?              @relation("RelistedAuction", fields: [originalAuctionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  relistedAuction          Auction?              @relation("RelistedAuction")
  seller                   Seller?               @relation(fields: [sellerId], references: [id])
  stateRef                 State?                @relation("StateAuctions", fields: [stateId], references: [id])
  tenant                   Tenant                @relation(fields: [tenantId], references: [id])
  habilitations            AuctionHabilitation[]
  stages                   AuctionStage[]
  bids                     Bid[]
  lots                     Lot[]
  LotQuestion              LotQuestion[]
  lotPrices                LotStagePrice[]
  notifications            Notification[]
  Review                   Review[]
  courts                   Court[]               @relation("AuctionToCourt")
  judicialBranches         JudicialBranch[]      @relation("AuctionToJudicialBranch")
  judicialDistricts        JudicialDistrict[]    @relation("AuctionToJudicialDistrict")

  @@index([auctioneerId])
  @@index([sellerId])
  @@index([categoryId])
  @@index([cityId])
  @@index([judicialProcessId])
  @@index([stateId])
  @@index([tenantId])
}

model AuctionStage {
  id              BigInt             @id @default(autoincrement())
  name            String
  startDate       DateTime          
  endDate         DateTime          
  auctionId       BigInt
  status          AuctionStageStatus @default(AGUARDANDO_INICIO)
  tenantId        BigInt
  discountPercent Decimal            @default(100.00) @db.Decimal(5, 2)
  auction         Auction            @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  tenant          Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lotPrices       LotStagePrice[]

  @@index([auctionId])
  @@index([tenantId])
}

model LotStagePrice {
  id             BigInt       @id @default(autoincrement())
  lotId          BigInt
  auctionId      BigInt
  auctionStageId BigInt
  initialBid     Decimal?     @db.Decimal(15, 2)
  bidIncrement   Decimal?     @db.Decimal(10, 2)
  tenantId       BigInt
  auction        Auction      @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  auctionStage   AuctionStage @relation(fields: [auctionStageId], references: [id], onDelete: Cascade)
  lot            Lot          @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([lotId, auctionStageId])
  @@index([auctionId])
  @@index([tenantId])
  @@index([auctionStageId])
}

model JudicialProcess {
  id            BigInt            @id @default(autoincrement())
  publicId      String            @unique
  processNumber String
  isElectronic  Boolean           @default(true)
  createdAt     DateTime?         @default(now())
  updatedAt     DateTime?         @updatedAt
  tenantId      BigInt
  courtId       BigInt?
  districtId    BigInt?
  branchId      BigInt?
  sellerId      BigInt?
  propertyMatricula        String?            @db.VarChar(50)
  propertyRegistrationNumber String?
  actionType               JudicialActionType?
  actionDescription        String?
  actionCnjCode            String?            @db.VarChar(20)
  assets        Asset[]
  auctions      Auction[]
  parties       JudicialParty[]
  branch        JudicialBranch?   @relation(fields: [branchId], references: [id])
  court         Court?            @relation(fields: [courtId], references: [id])
  district      JudicialDistrict? @relation(fields: [districtId], references: [id])
  seller        Seller?           @relation(fields: [sellerId], references: [id])
  tenant        Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  mediaItems    MediaItem[]
  lots          Lot[]             @relation("JudicialProcessToLot")

  @@unique([processNumber, tenantId])
  @@index([propertyMatricula])
  @@index([propertyRegistrationNumber])
  @@index([actionType])
  @@index([branchId])
  @@index([courtId])
  @@index([districtId])
  @@index([sellerId])
  @@index([tenantId])
}

model LotRisk {
  id                  BigInt       @id @default(autoincrement())
  lotId               BigInt
  riskType            LotRiskType
  riskLevel           LotRiskLevel
  riskDescription     String        @db.Text
  mitigationStrategy  String?       @db.Text
  verified            Boolean       @default(false)
  verifiedBy          BigInt?
  verifiedAt          DateTime?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  tenantId            BigInt
  lot                 Lot           @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant              Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  verifiedByUser      User?         @relation("LotRiskVerifiedBy", fields: [verifiedBy], references: [id])

  @@index([lotId])
  @@index([tenantId])
  @@index([riskLevel])
  @@index([riskType])
}

model JudicialParty {
  id             BigInt           @id @default(autoincrement())
  name           String
  documentNumber String?
  partyType      ProcessPartyType
  processId      BigInt
  tenantId       BigInt
  process        JudicialProcess  @relation(fields: [processId], references: [id], onDelete: Cascade)
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([processId])
  @@index([tenantId])
}

model Seller {
  id                BigInt            @id @default(autoincrement())
  publicId          String            @unique
  name              String            @unique
  description       String?           @db.Text
  logoUrl           String?           @db.Text
  logoMediaId       BigInt?
  dataAiHintLogo    String?
  website           String?           @db.Text
  email             String?           @db.Text
  phone             String?           @db.Text
  contactName       String?
  address           String?           @db.Text
  city              String?
  state             String?
  zipCode           String?
  slug              String            @unique
  isJudicial        Boolean           @default(false)
  judicialBranchId  BigInt?           @unique
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  tenantId          BigInt
  userId            BigInt?           @unique
  assets            Asset[]
  auctions          Auction[]
  directSaleOffers  DirectSaleOffer[]
  judicialProcesses JudicialProcess[]
  lots              Lot[]
  judicialBranch    JudicialBranch?   @relation(fields: [judicialBranchId], references: [id])
  tenant            Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user              User?             @relation(fields: [userId], references: [id])

  @@index([tenantId])
}

model Auctioneer {
  id                 BigInt    @id @default(autoincrement())
  publicId           String    @unique
  name               String
  slug               String    @unique
  description        String?   @db.Text
  registrationNumber String?
  logoUrl            String?   @db.Text
  logoMediaId        BigInt?
  dataAiHintLogo     String?
  website            String?   @db.Text
  email              String?
  phone              String?
  contactName        String?
  address            String?
  city               String?
  state              String?
  zipCode            String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  tenantId           BigInt
  userId             BigInt?   @unique
  auctions           Auction[]
  tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user               User?     @relation(fields: [userId], references: [id])
  lots               Lot[]

  @@index([tenantId])
}

model Court {
  id                BigInt             @id @default(autoincrement())
  slug              String             @unique
  name              String
  stateUf           String
  website           String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  judicialDistricts JudicialDistrict[]
  judicialProcesses JudicialProcess[]
  auctions          Auction[]          @relation("AuctionToCourt")
}

model JudicialDistrict {
  id                BigInt            @id @default(autoincrement())
  slug              String            @unique
  name              String            @unique
  courtId           BigInt?
  stateId           BigInt?
  zipCode           String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  judicialBranches  JudicialBranch[]
  court             Court?            @relation(fields: [courtId], references: [id])
  state             State?            @relation(fields: [stateId], references: [id])
  judicialProcesses JudicialProcess[]
  auctions          Auction[]         @relation("AuctionToJudicialDistrict")

  @@index([courtId])
  @@index([stateId])
}

model JudicialBranch {
  id                BigInt            @id @default(autoincrement())
  slug              String            @unique
  name              String            @unique
  districtId        BigInt?
  contactName       String?
  phone             String?
  email             String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  district          JudicialDistrict? @relation(fields: [districtId], references: [id])
  judicialProcesses JudicialProcess[]
  sellers           Seller?
  auctions          Auction[]         @relation("AuctionToJudicialBranch")

  @@index([districtId])
}

model State {
  id                BigInt             @id @default(autoincrement())
  slug              String             @unique
  name              String
  uf                String             @unique
  auctions          Auction[]          @relation("StateAuctions")
  cities            City[]
  judicialDistricts JudicialDistrict[]
  lots              Lot[]
}

model City {
  id        BigInt    @id @default(autoincrement())
  name      String
  stateId   BigInt
  ibgeCode  String?   @unique
  slug      String?
  lotCount  Int?      @default(0)
  createdAt DateTime? @default(now())
  updatedAt DateTime? @updatedAt
  auctions  Auction[] @relation("CityAuctions")
  state     State     @relation(fields: [stateId], references: [id])
  lots      Lot[]

  @@unique([name, stateId])
  @@index([stateId])
}

model AssetMedia {
  id           BigInt    @id @default(autoincrement())
  assetId      BigInt
  mediaItemId  BigInt
  isPrimary    Boolean   @default(false)
  displayOrder Int       @default(0)
  tenantId     BigInt
  asset        Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)
  mediaItem    MediaItem @relation(fields: [mediaItemId], references: [id], onDelete: Cascade)
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([mediaItemId])
  @@index([tenantId])
}

model Bid {
  id            BigInt   @id @default(autoincrement())
  lotId         BigInt
  auctionId     BigInt
  bidderId      BigInt
  amount        Decimal  @db.Decimal(15, 2)
  timestamp     DateTime @default(now())
  bidderDisplay String?
  tenantId      BigInt
  auction       Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  bidder        User     @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  lot           Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([lotId])
  @@index([bidderId])
  @@index([auctionId])
  @@index([tenantId])
}

model UserWin {
  id                 BigInt               @id @default(autoincrement())
  lotId              BigInt               @unique
  userId             BigInt
  winningBidAmount   Decimal              @db.Decimal(15, 2)
  winDate            DateTime             @default(now())
  paymentStatus      PaymentStatus        @default(PENDENTE)
  retrievalStatus    String               @default("PENDENTE")
  invoiceUrl         String?
  tenantId           BigInt
  installmentPayment InstallmentPayment[]
  lot                Lot                  @relation(fields: [lotId], references: [id])
  tenant             Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user               User                 @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([tenantId])
}

model InstallmentPayment {
  id                BigInt        @id @default(autoincrement())
  userWinId         BigInt
  installmentNumber Int
  totalInstallments Int
  amount            Decimal       @db.Decimal(15, 2)
  dueDate           DateTime
  paymentDate       DateTime?
  status            PaymentStatus @default(PENDENTE)
  paymentMethod     String?
  transactionId     String?
  tenantId          BigInt
  tenant            Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  userWin           UserWin       @relation(fields: [userWinId], references: [id], onDelete: Cascade)
  lot               Lot[]         @relation("InstallmentPaymentToLot")

  @@unique([userWinId, installmentNumber])
  @@index([userWinId])
  @@index([tenantId])
}

model UserLotMaxBid {
  id        BigInt    @id @default(autoincrement())
  userId    BigInt
  lotId     BigInt
  maxAmount Decimal   @db.Decimal(15, 2)
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  tenantId  BigInt
  updatedAt DateTime? @updatedAt
  lot       Lot       @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lotId])
  @@index([lotId])
  @@index([tenantId])
}

model LotCategory {
  id                   BigInt            @id @default(autoincrement())
  slug                 String            @unique
  name                 String            @unique
  description          String?           @db.Text
  logoUrl              String?
  logoMediaId          BigInt?
  dataAiHintLogo       String?
  coverImageUrl        String?
  coverImageMediaId    BigInt?
  dataAiHintCover      String?
  megaMenuImageUrl     String?
  megaMenuImageMediaId BigInt?
  dataAiHintMegaMenu   String?
  hasSubcategories     Boolean?          @default(false)
  isGlobal             Boolean           @default(true)
  tenantId             BigInt?
  createdAt            DateTime?         @default(now())
  updatedAt            DateTime?         @updatedAt
  assets               Asset[]
  auctions             Auction[]
  directSaleOffers     DirectSaleOffer[]
  lots                 Lot[]
  tenant               Tenant?           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  subcategories        Subcategory[]

  @@index([tenantId])
}

model Subcategory {
  id               BigInt      @id @default(autoincrement())
  name             String
  slug             String
  description      String?
  parentCategoryId BigInt
  displayOrder     Int         @default(0)
  iconUrl          String?
  iconMediaId      BigInt?
  dataAiHintIcon   String?
  isGlobal         Boolean     @default(true)
  tenantId         BigInt?
  assets           Asset[]
  lots             Lot[]
  parentCategory   LotCategory @relation(fields: [parentCategoryId], references: [id], onDelete: Cascade)
  tenant           Tenant?     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([name, parentCategoryId])
  @@index([tenantId])
  @@index([parentCategoryId])
}

model DirectSaleOffer {
  id                   BigInt                @id @default(autoincrement())
  publicId             String                @unique
  title                String
  description          String?               @db.Text
  offerType            DirectSaleOfferType
  price                Decimal?              @db.Decimal(15, 2)
  minimumOfferPrice    Decimal?              @db.Decimal(15, 2)
  status               DirectSaleOfferStatus @default(ACTIVE)
  locationCity         String?
  locationState        String?
  imageUrl             String?
  imageMediaId         BigInt?
  dataAiHint           String?
  galleryImageUrls     Json?
  mediaItemIds         Json?
  expiresAt            DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  categoryId           BigInt
  sellerId             BigInt
  sellerName           String?
  sellerLogoUrl        String?
  dataAiHintSellerLogo String?
  tenantId             BigInt
  itemsIncluded        Json?
  views                Int                   @default(0)
  category             LotCategory           @relation(fields: [categoryId], references: [id])
  seller               Seller                @relation(fields: [sellerId], references: [id])
  tenant               Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([sellerId])
  @@index([tenantId])
}

model Notification {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  lotId     BigInt?
  auctionId BigInt?
  tenantId  BigInt
  auction   Auction? @relation(fields: [auctionId], references: [id])
  lot       Lot?     @relation(fields: [lotId], references: [id])
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([auctionId])
  @@index([lotId])
  @@index([tenantId])
}

model UserDocument {
  id              BigInt             @id @default(autoincrement())
  status          UserDocumentStatus @default(PENDING_ANALYSIS)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  userId          BigInt
  documentTypeId  BigInt
  fileName        String?
  fileUrl         String
  rejectionReason String?
  tenantId        BigInt?
  documentType    DocumentType       @relation(fields: [documentTypeId], references: [id], onDelete: Cascade)
  tenant          Tenant?            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, documentTypeId])
  @@index([documentTypeId])
  @@index([tenantId])
}

model DocumentType {
  id          BigInt         @id @default(autoincrement())
  name        String         @unique
  description String?
  isRequired  Boolean        @default(true)
  appliesTo   String
  documents   UserDocument[]
}

model AuctionHabilitation {
  userId        BigInt
  auctionId     BigInt
  habilitatedAt DateTime @default(now())
  tenantId      BigInt
  auction       Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, auctionId])
  @@index([auctionId])
  @@index([tenantId])
}

model Review {
  id              BigInt   @id @default(autoincrement())
  lotId           BigInt
  auctionId       BigInt
  userId          BigInt
  rating          Int
  comment         String?  @db.Text
  createdAt       DateTime @default(now())
  userDisplayName String?
  tenantId        BigInt
  auction         Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  lot             Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([lotId])
  @@index([tenantId])
  @@index([auctionId])
  @@index([userId])
}

model LotQuestion {
  id                        BigInt    @id @default(autoincrement())
  lotId                     BigInt
  auctionId                 BigInt
  userId                    BigInt
  userDisplayName           String
  questionText              String    @db.Text
  answerText                String?   @db.Text
  isPublic                  Boolean   @default(true)
  createdAt                 DateTime  @default(now())
  answeredAt                DateTime?
  answeredByUserId          BigInt?
  answeredByUserDisplayName String?
  tenantId                  BigInt
  auction                   Auction   @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  lot                       Lot       @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant                    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                      User      @relation(fields: [userId], references: [id])

  @@index([lotId])
  @@index([tenantId])
  @@index([auctionId])
  @@index([userId])
}

model MediaItem {
  id                BigInt           @id @default(autoincrement())
  fileName          String
  storagePath       String
  urlOriginal       String
  urlThumbnail      String?
  urlMedium         String?
  urlLarge          String?
  mimeType          String
  sizeBytes         Int?
  altText           String?
  caption           String?
  description       String?          @db.Text
  title             String?
  dataAiHint        String?
  uploadedAt        DateTime         @default(now())
  uploadedByUserId  BigInt?
  judicialProcessId BigInt?
  linkedLotIds      Json?
  tenantId          BigInt?
  assetGallery      AssetMedia[]
  judicialProcess   JudicialProcess? @relation(fields: [judicialProcessId], references: [id])
  tenant            Tenant?          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy        User?            @relation("UploadedBy", fields: [uploadedByUserId], references: [id])

  @@index([tenantId])
  @@index([judicialProcessId])
  @@index([uploadedByUserId])
}

model PlatformSettings {
  id                         BigInt                  @id @default(autoincrement())
  tenantId                   BigInt                  @unique
  siteTitle                  String?
  siteTagline                String?
  logoUrl                    String?
  faviconUrl                 String?
  isSetupComplete            Boolean                 @default(false)
  crudFormMode               String?                 @default("modal")
  galleryImageBasePath       String?
  storageProvider            StorageProviderType?
  firebaseStorageBucket      String?
  activeThemeName            String?
  searchPaginationType       SearchPaginationType?
  searchItemsPerPage         Int?                    @default(12)
  searchLoadMoreCount        Int?                    @default(12)
  showCountdownOnLotDetail   Boolean?                @default(true)
  showCountdownOnCards       Boolean?                @default(true)
  showRelatedLotsOnLotDetail Boolean?                @default(true)
  relatedLotsCount           Int?                    @default(5)
  defaultUrgencyTimerHours   Int?
  defaultListItemsPerPage    Int?                    @default(10)
  auditTrailConfig           Json?
  updatedAt                  DateTime?               @updatedAt
  supportAddress             String?
  supportBusinessHours       String?
  supportEmail               String?
  supportPhone               String?
  supportWhatsApp            String?
  biddingSettings            BiddingSettings?        @relation("PlatformSettingsBiddingSettings")
  platformPublicIdMasks      IdMasks?
  mapSettings                MapSettings?
  mentalTriggerSettings      MentalTriggerSettings?
  notificationSettings       NotificationSettings?
  paymentGatewaySettings     PaymentGatewaySettings?
  realtimeSettings           RealtimeSettings?
  tenant                     Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sectionBadgeVisibility     SectionBadgeVisibility?
  themes                     ThemeSettings[]
  variableIncrementTable     VariableIncrementRule[]
}

model ThemeSettings {
  id                 BigInt            @id @default(autoincrement())
  name               String            @unique
  platformSettingsId BigInt?
  colors             ThemeColors?
  platformSettings   PlatformSettings? @relation(fields: [platformSettingsId], references: [id])

  @@index([platformSettingsId])
}

model ThemeColors {
  id              BigInt        @id @default(autoincrement())
  themeSettingsId BigInt        @unique
  light           Json?
  dark            Json?
  themeSettings   ThemeSettings @relation(fields: [themeSettingsId], references: [id], onDelete: Cascade)
}

model IdMasks {
  id                  BigInt           @id @default(autoincrement())
  platformSettingsId  BigInt           @unique
  auctionCodeMask     String?
  lotCodeMask         String?
  sellerCodeMask      String?
  auctioneerCodeMask  String?
  userCodeMask        String?
  assetCodeMask       String?
  categoryCodeMask    String?
  subcategoryCodeMask String?
  platformSettings    PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model VariableIncrementRule {
  id                 BigInt           @id @default(autoincrement())
  platformSettingsId BigInt
  from               Float
  to                 Float?
  increment          Float
  platformSettings   PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)

  @@index([platformSettingsId])
}

model MapSettings {
  id                 BigInt           @id @default(autoincrement())
  platformSettingsId BigInt           @unique
  defaultProvider    String?          @default("openstreetmap")
  googleMapsApiKey   String?
  platformSettings   PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model BiddingSettings {
  id                              BigInt           @id @default(autoincrement())
  platformSettingsId              BigInt           @unique
  instantBiddingEnabled           Boolean?         @default(true)
  getBidInfoInstantly             Boolean?         @default(true)
  biddingInfoCheckIntervalSeconds Int?             @default(1)
  defaultStageDurationDays        Int?             @default(7)
  defaultDaysBetweenStages        Int?             @default(1)
  platformSettings                PlatformSettings @relation("PlatformSettingsBiddingSettings", fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model PaymentGatewaySettings {
  id                           BigInt           @id @default(autoincrement())
  platformSettingsId           BigInt           @unique
  defaultGateway               String?          @default("Manual")
  platformCommissionPercentage Float?           @default(5)
  gatewayApiKey                String?
  gatewayEncryptionKey         String?
  platformSettings             PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model NotificationSettings {
  id                        BigInt           @id @default(autoincrement())
  platformSettingsId        BigInt           @unique
  notifyOnNewAuction        Boolean          @default(true)
  notifyOnFeaturedLot       Boolean          @default(false)
  notifyOnAuctionEndingSoon Boolean          @default(true)
  notifyOnPromotions        Boolean          @default(true)
  platformSettings          PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model MentalTriggerSettings {
  id                      BigInt           @id @default(autoincrement())
  platformSettingsId      BigInt           @unique
  showDiscountBadge       Boolean          @default(true)
  showPopularityBadge     Boolean          @default(true)
  popularityViewThreshold Int              @default(500)
  showHotBidBadge         Boolean          @default(true)
  hotBidThreshold         Int              @default(10)
  showExclusiveBadge      Boolean          @default(true)
  platformSettings        PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

/// RealtimeSettings - Configurações de Tempo Real & Blockchain
/// Modelo separado para gerenciar funcionalidades em tempo real, soft close e blockchain
/// Relacionamento 1:1 com PlatformSettings
model RealtimeSettings {
  id                        BigInt           @id @default(autoincrement())
  platformSettingsId        BigInt           @unique
  
  // Blockchain - Registro imutável de transações
  blockchainEnabled         Boolean          @default(false)
  blockchainNetwork         String           @default("NONE") // HYPERLEDGER, ETHEREUM, NONE
  
  // Soft Close (Anti-Sniping) - Default da plataforma, pode ser sobrescrito por leilão
  softCloseEnabled          Boolean          @default(false)
  softCloseMinutes          Int              @default(5)
  
  // Portal de Advogados - Monetização
  lawyerPortalEnabled       Boolean          @default(true)
  lawyerMonetizationModel   String           @default("SUBSCRIPTION") // SUBSCRIPTION, PAY_PER_USE, REVENUE_SHARE
  lawyerSubscriptionPrice   Int?             // Em centavos (ex: 19900 = R$ 199,00)
  lawyerPerUsePrice         Int?             // Em centavos (ex: 5000 = R$ 50,00)
  lawyerRevenueSharePercent Decimal?         @db.Decimal(5, 2) // Ex: 2.50 = 2.5%
  
  platformSettings          PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model SectionBadgeVisibility {
  id                 BigInt           @id @default(autoincrement())
  platformSettingsId BigInt           @unique
  searchGrid         Json?
  lotDetail          Json?
  platformSettings   PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model DataSource {
  id        BigInt @id @default(autoincrement())
  name      String
  modelName String @unique
  fields    Json
}

model Report {
  id          BigInt   @id @default(autoincrement())
  name        String
  description String?
  definition  Json
  tenantId    BigInt
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById BigInt
  createdBy   User     @relation("CreatedBy", fields: [createdById], references: [id])
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([tenantId])
}

model Subscriber {
  id          BigInt   @id @default(autoincrement())
  email       String
  name        String?
  phone       String?
  preferences Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenantId    BigInt
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([email, tenantId], name: "email_tenantId")
  @@index([tenantId])
}

model PasswordResetToken {
  id        BigInt   @id @default(autoincrement())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
}

model CounterState {
  id           BigInt   @id @default(autoincrement())
  tenantId     BigInt
  entityType   String
  currentValue Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([tenantId, entityType], name: "tenantId_entityType")
  @@index([tenantId])
}

model VehicleMake {
  id     BigInt         @id @default(autoincrement())
  name   String         @unique
  slug   String         @unique
  models VehicleModel[]
}

model VehicleModel {
  id     BigInt      @id @default(autoincrement())
  name   String
  slug   String
  makeId BigInt
  make   VehicleMake @relation(fields: [makeId], references: [id], onDelete: Cascade)

  @@unique([makeId, name])
  @@index([slug])
}

model BidderProfile {
  id                   BigInt                 @id @default(autoincrement())
  userId               BigInt                 @unique
  fullName             String?
  cpf                  String?                @unique
  phone                String?
  dateOfBirth          DateTime?
  address              String?
  city                 String?
  state                String?
  zipCode              String?
  documentStatus       BidderDocumentStatus   @default(PENDING)
  submittedDocuments   Json?
  emailNotifications   Boolean                @default(true)
  smsNotifications     Boolean                @default(false)
  isActive             Boolean                @default(true)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  tenantId             BigInt?
  notifications        BidderNotification[]
  tenant               Tenant?                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                 User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  participationHistory ParticipationHistory[]
  paymentMethods       PaymentMethod[]
  wonLots              WonLot[]

  @@index([tenantId])
  @@map("bidder_profiles")
}

model WonLot {
  id             BigInt         @id @default(autoincrement())
  bidderId       BigInt
  lotId          BigInt
  auctionId      BigInt
  title          String
  finalBid       Decimal        @db.Decimal(10, 2)
  wonAt          DateTime       @default(now())
  status         WonLotStatus   @default(WON)
  paymentStatus  PaymentStatus  @default(PENDENTE)
  totalAmount    Decimal        @db.Decimal(10, 2)
  paidAmount     Decimal        @default(0.00) @db.Decimal(10, 2)
  dueDate        DateTime?
  deliveryStatus DeliveryStatus @default(PENDING)
  trackingCode   String?
  invoiceUrl     String?
  receiptUrl     String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  tenantId       BigInt
  bidder         BidderProfile  @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  tenant         Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([bidderId])
  @@map("won_lots")
}

model BidderNotification {
  id        BigInt                 @id @default(autoincrement())
  bidderId  BigInt
  type      BidderNotificationType
  title     String
  message   String
  data      Json?
  isRead    Boolean                @default(false)
  readAt    DateTime?
  createdAt DateTime               @default(now())
  tenantId  BigInt?
  bidder    BidderProfile          @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  tenant    Tenant?                @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([bidderId])
  @@map("bidder_notifications")
}

model PaymentMethod {
  id         BigInt            @id @default(autoincrement())
  bidderId   BigInt
  type       PaymentMethodType
  isDefault  Boolean           @default(false)
  cardLast4  String?
  cardBrand  String?
  cardToken  String?
  pixKey     String?
  pixKeyType String?
  isActive   Boolean           @default(true)
  expiresAt  DateTime?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  tenantId   BigInt?
  bidder     BidderProfile     @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  tenant     Tenant?           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([bidderId])
  @@map("payment_methods")
}

model ParticipationHistory {
  id             BigInt              @id @default(autoincrement())
  bidderId       BigInt
  lotId          BigInt
  auctionId      BigInt
  title          String
  auctionName    String
  maxBid         Decimal?            @db.Decimal(10, 2)
  finalBid       Decimal?            @db.Decimal(10, 2)
  result         ParticipationResult
  participatedAt DateTime            @default(now())
  bidCount       Int                 @default(0)
  createdAt      DateTime            @default(now())
  tenantId       BigInt
  bidder         BidderProfile       @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  tenant         Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([bidderId])
  @@map("participation_history")
}

model ContactMessage {
  id        BigInt   @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model LotDocument {
  id           BigInt   @id @default(autoincrement())
  lotId        BigInt
  fileName     String
  title        String
  description  String?  @db.Text
  fileUrl      String   @db.Text
  fileSize     BigInt?
  mimeType     String?
  displayOrder Int      @default(0)
  isPublic     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  tenantId     BigInt
  lot          Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([lotId])
  @@index([tenantId])
}

model DocumentTemplate {
  id        BigInt               @id @default(autoincrement())
  name      String               @unique
  type      DocumentTemplateType
  content   String?              @db.Text
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
}

model AuditLog {
  id         BigInt      @id @default(autoincrement())
  tenantId   BigInt?
  userId     BigInt
  entityType String
  entityId   BigInt
  action     AuditAction
  changes    Json?
  metadata   Json?
  ipAddress  String?     @db.Text
  userAgent  String?     @db.Text
  location   String?     @db.Text
  timestamp  DateTime    @default(now())
  tenant     Tenant?     @relation(fields: [tenantId], references: [id])
  user       User        @relation(fields: [userId], references: [id])

  @@index([tenantId, entityType, entityId])
  @@index([userId])
  @@index([timestamp])
  @@index([action])
  @@map("audit_logs")
}

model ValidationRule {
  id           BigInt             @id @default(autoincrement())
  entityType   String
  fieldName    String
  ruleType     ValidationType
  config       Json
  isRequired   Boolean            @default(false)
  errorMessage String             @db.Text
  severity     ValidationSeverity @default(ERROR)
  isActive     Boolean            @default(true)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt

  @@unique([entityType, fieldName, ruleType])
  @@index([entityType])
  @@map("validation_rules")
}

model FormSubmission {
  id               BigInt           @id @default(autoincrement())
  tenantId         BigInt?
  userId           BigInt
  formType         String
  entityId         BigInt?
  status           SubmissionStatus
  validationScore  Int
  data             Json
  validationErrors Json?
  submittedAt      DateTime         @default(now())
  completedAt      DateTime?
  tenant           Tenant?          @relation(fields: [tenantId], references: [id])
  user             User             @relation(fields: [userId], references: [id])

  @@index([tenantId, formType])
  @@index([userId])
  @@index([status])
  @@map("form_submissions")
}

model Visitor {
  id             BigInt           @id @default(autoincrement())
  visitorId      String           @unique
  userId         BigInt?
  firstVisitAt   DateTime         @default(now())
  lastVisitAt    DateTime         @default(now())
  firstUserAgent String?          @db.Text
  firstIpAddress String?          @db.Text
  firstReferrer  String?          @db.Text
  country        String?
  region         String?
  city           String?
  deviceType     String?
  browser        String?
  os             String?
  totalVisits    Int              @default(1)
  totalPageViews Int              @default(0)
  totalEvents    Int              @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  events         VisitorEvent[]
  sessions       VisitorSession[]

  @@index([userId])
  @@index([lastVisitAt])
  @@index([country])
  @@map("visitors")
}

model VisitorSession {
  id             BigInt         @id @default(autoincrement())
  sessionId      String         @unique
  visitorId      BigInt
  startedAt      DateTime       @default(now())
  endedAt        DateTime?
  lastActivityAt DateTime       @default(now())
  userAgent      String?        @db.Text
  ipAddress      String?        @db.Text
  referrer       String?        @db.Text
  utmSource      String?
  utmMedium      String?
  utmCampaign    String?
  pageViews      Int            @default(0)
  eventsCount    Int            @default(0)
  duration       Int?
  events         VisitorEvent[]
  visitor        Visitor        @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([visitorId])
  @@index([startedAt])
  @@index([sessionId])
  @@map("visitor_sessions")
}

model VisitorEvent {
  id             BigInt           @id @default(autoincrement())
  eventId        String           @unique
  visitorId      BigInt
  sessionId      BigInt
  eventType      VisitorEventType
  entityType     String?
  entityId       BigInt?
  entityPublicId String?
  metadata       Json?
  pageUrl        String?          @db.Text
  timestamp      DateTime         @default(now())
  session        VisitorSession   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  visitor        Visitor          @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([visitorId])
  @@index([sessionId])
  @@index([eventType])
  @@index([entityType, entityId])
  @@index([entityPublicId])
  @@index([timestamp])
  @@map("visitor_events")
}

model EntityViewMetrics {
  id             BigInt    @id @default(autoincrement())
  entityType     String
  entityId       BigInt
  entityPublicId String?
  tenantId       BigInt?
  totalViews     Int       @default(0)
  uniqueViews    Int       @default(0)
  viewsLast24h   Int       @default(0)
  viewsLast7d    Int       @default(0)
  viewsLast30d   Int       @default(0)
  sharesCount    Int       @default(0)
  favoritesCount Int       @default(0)
  lastViewedAt   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@unique([entityType, entityId])
  @@index([entityPublicId])
  @@index([tenantId])
  @@index([totalViews])
  @@index([viewsLast24h])
  @@map("entity_view_metrics")
}

model ITSM_Ticket {
  id               BigInt            @id @default(autoincrement())
  publicId         String            @unique
  userId           BigInt
  title            String
  description      String            @db.Text
  status           ITSM_TicketStatus @default(ABERTO)
  priority         ITSM_Priority     @default(MEDIA)
  category         ITSM_Category     @default(OUTRO)
  userSnapshot     Json?
  userAgent        String?           @db.Text
  browserInfo      String?           @db.Text
  screenSize       String?
  pageUrl          String?           @db.Text
  errorLogs        Json?
  assignedToUserId BigInt?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  resolvedAt       DateTime?
  closedAt         DateTime?
  tenantId         BigInt?
  attachments      ITSM_Attachment[]
  chatLogs         ITSM_ChatLog[]
  messages         ITSM_Message[]
  assignedToUser   User?             @relation("ITSM_AssignedTickets", fields: [assignedToUserId], references: [id])
  tenant           Tenant?           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user             User              @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([assignedToUserId])
  @@index([tenantId])
  @@map("itsm_tickets")
}

model ITSM_Message {
  id         BigInt      @id @default(autoincrement())
  ticketId   BigInt
  userId     BigInt
  message    String      @db.Text
  isInternal Boolean     @default(false)
  createdAt  DateTime    @default(now())
  ticket     ITSM_Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  user       User        @relation(fields: [userId], references: [id])

  @@index([ticketId])
  @@index([userId])
  @@map("itsm_messages")
}

model ITSM_Attachment {
  id             BigInt      @id @default(autoincrement())
  ticketId       BigInt
  fileName       String
  fileUrl        String      @db.Text
  fileSize       Int?
  mimeType       String?
  uploadedBy     BigInt
  createdAt      DateTime    @default(now())
  ticket         ITSM_Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  uploadedByUser User        @relation(fields: [uploadedBy], references: [id])

  @@index([ticketId])
  @@index([uploadedBy])
  @@map("itsm_attachments")
}

model ITSM_ChatLog {
  id            BigInt       @id @default(autoincrement())
  ticketId      BigInt?
  userId        BigInt
  messages      Json
  sessionId     String?
  context       Json?
  wasHelpful    Boolean?
  ticketCreated Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  tenantId      BigInt?
  tenant        Tenant?      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ticket        ITSM_Ticket? @relation(fields: [ticketId], references: [id])
  user          User         @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([sessionId])
  @@index([tenantId])
  @@index([ticketId])
  @@map("itsm_chat_logs")
}

model ITSM_QueryLog {
  id           BigInt   @id @default(autoincrement())
  query        String   @db.Text
  duration     Int
  success      Boolean
  errorMessage String?  @db.Text
  userId       BigInt?
  endpoint     String?
  method       String?
  ipAddress    String?
  timestamp    DateTime @default(now())
  user         User?    @relation(fields: [userId], references: [id])

  @@index([timestamp])
  @@index([userId])
  @@index([success])
  @@map("itsm_query_logs")
}

enum AuctionStageStatus {
  RASCUNHO
  AGENDADO
  EM_ANDAMENTO
  SUSPENSO
  CONCLUIDO
  CANCELADO
  AGUARDANDO_INICIO
  ABERTO
  FECHADO
}

enum AssetStatus {
  CADASTRO
  DISPONIVEL
  LOTEADO
  VENDIDO
  REMOVIDO
  INATIVADO
}

enum OccupationStatus {
  OCCUPIED
  UNOCCUPIED
  UNCERTAIN
  SHARED_POSSESSION
}

enum AuctionStatus {
  RASCUNHO
  EM_PREPARACAO
  EM_BREVE
  ABERTO
  ABERTO_PARA_LANCES
  ENCERRADO
  FINALIZADO
  CANCELADO
  SUSPENSO
}

enum JudicialActionType {
  USUCAPIAO
  REMOCAO
  HIPOTECA
  DESPEJO
  PENHORA
  COBRANCA
  INVENTARIO
  DIVORCIO
  OUTROS
}

enum LotStatus {
  RASCUNHO
  EM_BREVE
  ABERTO_PARA_LANCES
  ENCERRADO
  VENDIDO
  NAO_VENDIDO
  RELISTADO
  CANCELADO
  RETIRADO
}

enum LotRiskType {
  OCUPACAO_IRREGULAR
  PENHORA
  INSCRICAO_DIVIDA
  RESTRICAO_AMBIENTAL
  DOENCA_ACARAJADO
  OUTRO
}

enum LotRiskLevel {
  BAIXO
  MEDIO
  ALTO
  CRITICO
}

enum UserHabilitationStatus {
  PENDING_DOCUMENTS
  PENDING_ANALYSIS
  HABILITADO
  REJECTED_DOCUMENTS
  BLOCKED
}

enum AccountType {
  PHYSICAL
  LEGAL
  DIRECT_SALE_CONSIGNOR
}

enum PaymentStatus {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  REEMBOLSADO
  CANCELADO
  ATRASADO
}

enum AuctionType {
  JUDICIAL
  EXTRAJUDICIAL
  PARTICULAR
  TOMADA_DE_PRECOS
  VENDA_DIRETA
}

enum AuctionMethod {
  STANDARD
  DUTCH
  SILENT
}

enum AuctionParticipation {
  ONLINE
  PRESENCIAL
  HIBRIDO
}

enum ProcessPartyType {
  AUTOR
  REU
  ADVOGADO_AUTOR
  ADVOGADO_REU
  JUIZ
  ESCRIVAO
  PERITO
  ADMINISTRADOR_JUDICIAL
  TERCEIRO_INTERESSADO
  OUTRO
}

enum UserDocumentStatus {
  NOT_SENT
  SUBMITTED
  PENDING_ANALYSIS
  APPROVED
  REJECTED
}

enum DirectSaleOfferStatus {
  ACTIVE
  PENDING_APPROVAL
  SOLD
  EXPIRED
  RASCUNHO
}

enum DirectSaleOfferType {
  BUY_NOW
  ACCEPTS_PROPOSALS
}

enum StorageProviderType {
  LOCAL
  FIREBASE
}

enum SearchPaginationType {
  loadMore
  numberedPages
}

enum DocumentTemplateType {
  WINNING_BID_TERM
  EVALUATION_REPORT
  AUCTION_CERTIFICATE
}

enum BidderDocumentStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  EXPIRED
}

enum BidderNotificationType {
  AUCTION_WON
  PAYMENT_DUE
  PAYMENT_OVERDUE
  DOCUMENT_APPROVED
  DOCUMENT_REJECTED
  DELIVERY_UPDATE
  AUCTION_ENDING
  SYSTEM_UPDATE
}

enum PaymentMethodType {
  CREDIT_CARD
  DEBIT_CARD
  PIX
  BOLETO
  BANK_TRANSFER
}

enum ParticipationResult {
  WON
  LOST
  WITHDRAWN
}

enum WonLotStatus {
  WON
  PAID
  DELIVERED
  CANCELLED
}

enum DeliveryStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  FAILED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  SOFT_DELETE
  RESTORE
  PUBLISH
  UNPUBLISH
  APPROVE
  REJECT
  EXPORT
  IMPORT
}

enum ValidationType {
  REQUIRED
  MIN_LENGTH
  MAX_LENGTH
  PATTERN
  MIN_VALUE
  MAX_VALUE
  DATE_RANGE
  FILE_TYPE
  FILE_SIZE
  CUSTOM
}

enum ValidationSeverity {
  ERROR
  WARNING
  INFO
}

enum SubmissionStatus {
  DRAFT
  VALIDATING
  VALID
  INVALID
  SUBMITTED
  FAILED
}

enum VisitorEventType {
  PAGE_VIEW
  LOT_VIEW
  AUCTION_VIEW
  SEARCH
  FILTER_APPLIED
  BID_CLICK
  SHARE_CLICK
  FAVORITE_ADD
  FAVORITE_REMOVE
  DOCUMENT_DOWNLOAD
  IMAGE_VIEW
  VIDEO_PLAY
  CONTACT_CLICK
  HABILITATION_START
}

enum ITSM_TicketStatus {
  ABERTO
  EM_ANDAMENTO
  AGUARDANDO_USUARIO
  RESOLVIDO
  FECHADO
  CANCELADO
}

enum ITSM_Priority {
  BAIXA
  MEDIA
  ALTA
  CRITICA
}

enum ITSM_Category {
  TECNICO
  FUNCIONAL
  DUVIDA
  SUGESTAO
  BUG
  OUTRO
}
