// prisma/schema.prisma

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "./node_modules/@prisma/client"
}

// =================================================================
// Global Models (Not Tenant-Specific)
// =================================================================

model User {
  id                      String                  @id @default(cuid())
  email                   String                  @unique
  password                String?
  fullName                String?
  cpf                     String?
  rgNumber                String?
  rgIssuer                String?
  rgIssueDate             DateTime?
  rgState                 String?
  dateOfBirth             DateTime?
  cellPhone               String?
  homePhone               String?
  gender                  String?
  profession              String?
  nationality             String?
  maritalStatus           String?
  propertyRegime          String?
  spouseName              String?
  spouseCpf               String?
  zipCode                 String?
  street                  String?
  number                  String?
  complement              String?
  neighborhood            String?
  city                    String?
  state                   String?
  avatarUrl               String?
  dataAiHint              String?
  habilitationStatus      UserHabilitationStatus  @default(PENDING_DOCUMENTS)
  accountType             AccountType             @default(PHYSICAL)
  badges                  Json?
  razaoSocial             String?
  cnpj                    String?
  inscricaoEstadual       String?
  website                 String?
  responsibleName         String?
  responsibleCpf          String?
  optInMarketing          Boolean?                @default(false)
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt
  roles                   UsersOnRoles[]
  tenants                 UsersOnTenants[]
  documents               UserDocument[]
  bids                    Bid[]
  wins                    UserWin[]
  maxBids                 UserLotMaxBid[]
  questions               LotQuestion[]
  reviews                 Review[]
  notifications           Notification[]
  uploadedMedia           MediaItem[]             @relation("UploadedBy")
  sellerProfile           Seller?
  auctioneerProfile       Auctioneer?
}

model Role {
  id             String         @id @default(cuid())
  name           String         @unique
  nameNormalized String         @unique
  description    String?
  permissions    Json?
  users          UsersOnRoles[]
}

model UsersOnRoles {
  userId     String
  roleId     String
  assignedAt DateTime @default(now())
  assignedBy String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([roleId])
}

model State {
  id        String             @id @default(cuid())
  name      String
  uf        String             @unique
  slug      String?            @unique
  cities    City[]
  auctions  Auction[]
  lots      Lot[]
  districts JudicialDistrict[]
  createdAt DateTime?          @default(now())
  updatedAt DateTime?          @updatedAt
  cityCount Int?               @default(0)
}

model City {
  id        String     @id @default(cuid())
  name      String
  slug      String?
  ibgeCode  String?    @unique
  state     State      @relation(fields: [stateId], references: [id])
  stateId   String
  auctions  Auction[]
  lots      Lot[]
  createdAt DateTime?  @default(now())
  updatedAt DateTime?  @updatedAt
  lotCount  Int?       @default(0)

  @@unique([name, stateId])
}

model LotCategory {
  id                   String        @id @default(cuid())
  name                 String        @unique
  slug                 String        @unique
  description          String?
  coverImageMediaId    String?
  coverImageUrl        String?
  dataAiHintCover      String?
  logoMediaId          String?
  logoUrl              String?
  dataAiHintLogo       String?
  megaMenuImageMediaId String?
  megaMenuImageUrl     String?
  dataAiHintMegaMenu   String?
  hasSubcategories     Boolean?      @default(false)
  subcategories        Subcategory[]
  assets               Asset[]
  lots                 Lot[]
  auctions             Auction[]     @relation("_AuctionToLotCategory")
  createdAt            DateTime?     @default(now())
  updatedAt            DateTime?     @updatedAt
}

model Subcategory {
  id                 String       @id @default(cuid())
  name               String
  slug               String
  description        String?
  iconMediaId        String?
  iconUrl            String?
  dataAiHintIcon     String?
  displayOrder       Int          @default(0)
  parentCategory     LotCategory  @relation(fields: [parentCategoryId], references: [id], onDelete: Cascade)
  parentCategoryId   String
  assets             Asset[]
  lots               Lot[]

  @@unique([name, parentCategoryId])
}

model VehicleMake {
  id     String         @id @default(cuid())
  name   String         @unique
  slug   String         @unique
  models VehicleModel[]
}

model VehicleModel {
  id     String      @id @default(cuid())
  name   String
  slug   String
  make   VehicleMake @relation(fields: [makeId], references: [id], onDelete: Cascade)
  makeId String

  @@unique([makeId, name])
  @@index([slug])
}

model DocumentType {
  id          String         @id @default(cuid())
  name        String         @unique
  description String?
  isRequired  Boolean        @default(true)
  appliesTo   String // Comma-separated: PHYSICAL, LEGAL, ALL
  userDocs    UserDocument[]
}

model DocumentTemplate {
  id        String               @id @default(cuid())
  name      String               @unique
  type      DocumentTemplateType
  content   String?              @db.Text
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
}

model Court {
  id                String             @id @default(cuid())
  name              String
  slug              String?            @unique
  stateUf           String?
  website           String?
  createdAt         DateTime?          @default(now())
  updatedAt         DateTime?          @updatedAt
  districts         JudicialDistrict[]
  auctions          Auction[]          @relation("_AuctionToCourt")
  judicialProcesses JudicialProcess[]
}

model JudicialDistrict {
  id                String             @id @default(cuid())
  name              String
  slug              String?            @unique
  zipCode           String?
  courtId           String?
  stateId           String?
  createdAt         DateTime?          @default(now())
  updatedAt         DateTime?          @updatedAt
  court             Court?             @relation(fields: [courtId], references: [id], onDelete: SetNull)
  state             State?             @relation(fields: [stateId], references: [id], onDelete: SetNull)
  branches          JudicialBranch[]
  auctions          Auction[]          @relation("_AuctionToJudicialDistrict")
  judicialProcesses JudicialProcess[]
}

model JudicialBranch {
  id                String             @id @default(cuid())
  name              String             @unique
  slug              String?            @unique
  contactName       String?
  phone             String?
  email             String?
  districtId        String?
  createdAt         DateTime?          @default(now())
  updatedAt         DateTime?          @updatedAt
  district          JudicialDistrict?  @relation(fields: [districtId], references: [id], onDelete: SetNull)
  judicialProcesses JudicialProcess[]
  auctions          Auction[]          @relation("_AuctionToJudicialBranch")
  seller            Seller?
}

// =================================================================
// Tenant-Specific Models
// =================================================================

model Tenant {
  id           String             @id @default(cuid())
  name         String
  subdomain    String             @unique
  domain       String?            @unique
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  users        UsersOnTenants[]
  auctions     Auction[]
  lots         Lot[]
  assets       Asset[]
  sellers      Seller[]
  auctioneers  Auctioneer[]
  subscribers  Subscriber[]
  bids         Bid[]
  notifications Notification[]
  judicialProcesses JudicialProcess[]
  reports      Report[]
  settings     PlatformSettings?
}

model UsersOnTenants {
  userId     String
  tenantId   String
  assignedAt DateTime @default(now())
  assignedBy String?
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@id([userId, tenantId])
  @@index([tenantId])
}

model PlatformSettings {
  id                     String                    @id @default("global")
  siteTitle              String?
  siteTagline            String?
  logoUrl                String?
  faviconUrl             String?
  galleryImageBasePath   String?
  storageProvider        String?
  firebaseStorageBucket  String?
  activeThemeName        String?
  themes                 Json?
  platformPublicIdMasks  Json?
  homepageSections       Json?
  mentalTriggerSettings  Json?
  sectionBadgeVisibility Json?
  mapSettings            Json?
  searchPaginationType   SearchPaginationType      @default(loadMore)
  searchItemsPerPage     Int                       @default(12)
  searchLoadMoreCount    Int                       @default(12)
  showCountdownOnLotDetail Boolean                 @default(true)
  showCountdownOnCards   Boolean                   @default(true)
  showRelatedLotsOnLotDetail Boolean               @default(true)
  relatedLotsCount       Int                       @default(5)
  defaultUrgencyTimerHours Int?
  variableIncrementTable Json?
  biddingSettings        Json?
  paymentGatewaySettings Json?
  defaultListItemsPerPage Int                      @default(10)
  updatedAt              DateTime?                 @updatedAt
  tenantId               String                    @unique
  tenant                 Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  isSetupComplete        Boolean                   @default(false)
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Subscriber {
  id          String    @id @default(cuid())
  email       String    @unique
  name        String?
  phone       String?
  preferences Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tenantId    String
  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
}

model Seller {
  id                String             @id @default(cuid())
  name              String
  publicId          String             @unique
  slug              String             @unique
  description       String?            @db.Text
  logoUrl           String?            @db.Text
  logoMediaId       String?
  dataAiHintLogo    String?
  website           String?            @db.Text
  contactName       String?
  email             String?
  phone             String?
  address           String?            @db.Text
  city              String?
  state             String?
  zipCode           String?
  isJudicial        Boolean            @default(false)
  judicialBranchId  String?            @unique
  judicialBranch    JudicialBranch?    @relation(fields: [judicialBranchId], references: [id], onDelete: SetNull)
  userId            String?            @unique
  user              User?              @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  tenantId          String
  tenant            Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  auctions          Auction[]
  lots              Lot[]
  assets            Asset[]
  directSaleOffers  DirectSaleOffer[]
}

model Auctioneer {
  id                  String     @id @default(cuid())
  name                String
  publicId            String     @unique
  slug                String     @unique
  registrationNumber  String?
  description         String?    @db.Text
  logoUrl             String?    @db.Text
  logoMediaId         String?
  dataAiHintLogo      String?
  website             String?    @db.Text
  contactName         String?
  email               String?
  phone               String?
  address             String?    @db.Text
  city                String?
  state               String?
  zipCode             String?
  userId              String?    @unique
  user                User?      @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  tenantId            String
  tenant              Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  auctions            Auction[]
  lots                Lot[]
}

model JudicialProcess {
  id                String         @id @default(cuid())
  publicId          String         @unique
  processNumber     String
  isElectronic      Boolean        @default(true)
  courtId           String?
  districtId        String?
  branchId          String?
  sellerId          String?
  createdAt         DateTime?      @default(now())
  updatedAt         DateTime?      @updatedAt
  tenantId          String
  tenant            Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  court             Court?         @relation(fields: [courtId], references: [id], onDelete: SetNull)
  district          JudicialDistrict? @relation(fields: [districtId], references: [id], onDelete: SetNull)
  branch            JudicialBranch? @relation(fields: [branchId], references: [id], onDelete: SetNull)
  seller            Seller?        @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  parties           JudicialParty[]
  assets            Asset[]
  auctions          Auction[]

  @@unique([processNumber, tenantId])
}

model JudicialParty {
  id             String          @id @default(cuid())
  name           String
  documentNumber String?
  partyType      ProcessPartyType
  processId      String
  process        JudicialProcess @relation(fields: [processId], references: [id], onDelete: Cascade)

  @@index([processId])
}

model Asset {
  id                          String      @id @default(cuid())
  publicId                    String      @unique
  title                       String
  description                 String?     @db.Text
  status                      AssetStatus @default(DISPONIVEL)
  categoryId                  String?
  subcategoryId               String?
  judicialProcessId           String?
  sellerId                    String?
  evaluationValue             Decimal?    @db.Decimal(15, 2)
  imageUrl                    String?
  imageMediaId                String?
  galleryImageUrls            Json?
  mediaItemIds                Json?
  dataAiHint                  String?
  locationCity                String?
  locationState               String?
  address                     String?
  latitude                    Decimal?
  longitude                   Decimal?
  createdAt                   DateTime    @default(now())
  updatedAt                   DateTime    @updatedAt
  tenantId                    String
  tenant                      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  category                    LotCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  subcategory                 Subcategory? @relation(fields: [subcategoryId], references: [id], onDelete: SetNull)
  judicialProcess             JudicialProcess? @relation(fields: [judicialProcessId], references: [id], onDelete: SetNull)
  seller                      Seller?     @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  lots                        AssetsOnLots[]
  // Vehicle Specific
  plate                       String?
  make                        String?
  model                       String?
  version                     String?
  year                        Int?
  modelYear                   Int?
  mileage                     Int?
  color                       String?
  fuelType                    String?
  transmissionType            String?
  bodyType                    String?
  vin                         String?     @unique
  renavam                     String?     @unique
  enginePower                 String?
  numberOfDoors               Int?
  vehicleOptions              String?     @db.Text
  detranStatus                String?     @db.Text
  debts                       String?     @db.Text
  runningCondition            String?
  bodyCondition               String?
  tiresCondition              String?
  hasKey                      Boolean?
  // Real Estate Specific
  propertyRegistrationNumber  String?
  iptuNumber                  String?
  isOccupied                  Boolean?
  totalArea                   Decimal?
  builtArea                   Decimal?
  bedrooms                    Int?
  suites                      Int?
  bathrooms                   Int?
  parkingSpaces               Int?
  constructionType            String?
  finishes                    String?     @db.Text
  infrastructure              String?     @db.Text
  condoDetails                String?     @db.Text
  improvements                String?     @db.Text
  topography                  String?
  liensAndEncumbrances        String?     @db.Text
  propertyDebts               String?     @db.Text
  unregisteredRecords         String?     @db.Text
  hasHabiteSe                 Boolean?
  zoningRestrictions          String?
  amenities                   Json?
  // Machinery & Others
  brand                       String?
  serialNumber                String?
  itemCondition               String?
  specifications              String?     @db.Text
  includedAccessories         String?     @db.Text
  batteryCondition            String?
  hasInvoice                  Boolean?
  hasWarranty                 Boolean?
  repairHistory               String?     @db.Text
  applianceCapacity           String?
  voltage                     String?
  applianceType               String?
  additionalFunctions         String?
  hoursUsed                   Int?
  engineType                  String?
  capacityOrPower             String?
  maintenanceHistory          String?     @db.Text
  installationLocation        String?
  compliesWithNR              String?
  operatingLicenses           String?
  breed                       String?
  age                         String?
  sex                         String?
  weight                      String?
  individualId                String?
  purpose                     String?
  sanitaryCondition           String?     @db.Text
  lineage                     String?
  isPregnant                  Boolean?
  specialSkills               String?
  gtaDocument                 String?
  breedRegistryDocument       String?
  furnitureType               String?
  material                    String?
  style                       String?
  dimensions                  String?
  pieceCount                  Int?
  jewelryType                 String?
  metal                       String?
  gemstones                   String?
  totalWeight                 String?
  jewelrySize                 String?
  authenticityCertificate     String?
  workType                    String?
  artist                      String?
  period                      String?
  technique                   String?
  provenance                  String?     @db.Text
  boatType                    String?
  boatLength                  String?
  hullMaterial                String?
  onboardEquipment            String?     @db.Text
  productName                 String?
  quantity                    String?
  packagingType               String?
  expirationDate              DateTime?
  storageConditions           String?
  preciousMetalType           String?
  purity                      String?
  forestGoodsType             String?
  volumeOrQuantity            String?
  species                     String?
  dofNumber                   String?

  @@index([tenantId])
}

model Auction {
  id                        String             @id @default(cuid())
  publicId                  String?            @unique
  slug                      String?            @unique
  title                     String
  description               String?            @db.Text
  status                    AuctionStatus      @default(RASCUNHO)
  auctionDate               DateTime?
  endDate                   DateTime?
  totalLots                 Int                @default(0)
  visits                    Int                @default(0)
  totalHabilitatedUsers     Int                @default(0)
  initialOffer              Decimal?           @db.Decimal(15, 2)
  auctionType               AuctionType?
  auctionMethod             AuctionMethod      @default(STANDARD)
  participation             AuctionParticipation @default(ONLINE)
  onlineUrl                 String?            @db.VarChar(500)
  address                   String?
  zipCode                   String?            @db.VarChar(10)
  latitude                  Decimal?           @db.Decimal(10, 8)
  longitude                 Decimal?           @db.Decimal(11, 8)
  documentsUrl              String?            @db.VarChar(500)
  isFeaturedOnMarketplace   Boolean            @default(false)
  softCloseEnabled          Boolean?           @default(false)
  softCloseMinutes          Int?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @updatedAt
  tenantId                  String
  tenant                    Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  auctioneerId              String?
  auctioneer                Auctioneer?        @relation(fields: [auctioneerId], references: [id], onDelete: SetNull)
  sellerId                  String?
  seller                    Seller?            @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  cityId                    String?
  city                      City?              @relation(fields: [cityId], references: [id], onDelete: SetNull)
  stateId                   String?
  state                     State?             @relation(fields: [stateId], references: [id], onDelete: SetNull)
  judicialProcessId         String?
  judicialProcess           JudicialProcess?   @relation(fields: [judicialProcessId], references: [id], onDelete: SetNull)
  achievedRevenue           Decimal?           @db.Decimal(15, 2)
  auctionCertificateUrl     String?            @db.VarChar(500)
  decrementAmount           Decimal?           @db.Decimal(10, 2)
  decrementIntervalSeconds  Int?
  evaluationReportUrl       String?            @db.VarChar(500)
  floorPrice                Decimal?           @db.Decimal(15, 2)
  additionalTriggers        String?
  imageMediaId              String?
  isRelisted                Boolean            @default(false)
  originalAuctionId         String?            @unique
  originalAuction           Auction?           @relation("RelistedAuctions", fields: [originalAuctionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  relistedAuctions          Auction[]          @relation("RelistedAuctions")
  relistCount               Int                @default(0)
  lots                      Lot[]
  bids                      Bid[]
  questions                 LotQuestion[]
  reviews                   Review[]
  stages                    AuctionStage[]
  habilitations             AuctionHabilitation[]
  categories                LotCategory[]      @relation("_AuctionToLotCategory")
  courts                    Court[]            @relation("_AuctionToCourt")
  judicialDistricts         JudicialDistrict[] @relation("_AuctionToJudicialDistrict")
  judicialBranches          JudicialBranch[]   @relation("_AuctionToJudicialBranch")

  @@index([auctioneerId])
  @@index([sellerId])
  @@index([status])
  @@index([auctionType])
  @@index([tenantId])
}

model Lot {
  id                        String              @id @default(cuid())
  publicId                  String?             @unique
  auctionId                 String
  auction                   Auction             @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  number                    String?
  title                     String
  description               String?             @db.Text
  slug                      String?
  price                     Decimal             @db.Decimal(15, 2)
  initialPrice              Decimal?            @db.Decimal(15, 2)
  secondInitialPrice        Decimal?            @db.Decimal(15, 2)
  bidIncrementStep          Decimal?            @db.Decimal(10, 2)
  status                    LotStatus           @default(EM_BREVE)
  bidsCount                 Int?                @default(0)
  views                     Int?                @default(0)
  isFeatured                Boolean?            @default(false)
  isExclusive               Boolean?            @default(false)
  discountPercentage        Int?
  additionalTriggers        Json?
  imageUrl                  String?             @db.Text
  imageMediaId              String?
  galleryImageUrls          Json?
  mediaItemIds              Json?
  type                      String
  condition                 String?
  dataAiHint                String?
  winningBidTermUrl         String?
  allowInstallmentBids      Boolean?            @default(false)
  isRelisted                Boolean             @default(false)
  relistCount               Int                 @default(0)
  createdAt                 DateTime            @default(now())
  updatedAt                 DateTime            @updatedAt
  endDate                   DateTime?
  lotSpecificAuctionDate    DateTime?
  secondAuctionDate         DateTime?
  tenantId                  String
  tenant                    Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  categoryId                String?
  category                  LotCategory?        @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  subcategoryId             String?
  subcategory               Subcategory?        @relation(fields: [subcategoryId], references: [id], onDelete: SetNull)
  sellerId                  String?
  seller                    Seller?             @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  auctioneerId              String?
  auctioneer                Auctioneer?         @relation(fields: [auctioneerId], references: [id], onDelete: SetNull)
  cityId                    String?
  city                      City?               @relation(fields: [cityId], references: [id], onDelete: SetNull)
  stateId                   String?
  state                     State?              @relation(fields: [stateId], references: [id], onDelete: SetNull)
  cityName                  String?
  stateUf                   String?
  latitude                  Decimal?
  longitude                 Decimal?
  mapAddress                String?
  winnerId                  String?
  winner                    User?               @relation(fields: [winnerId], references: [id], onDelete: SetNull)
  auctionDate               DateTime?
  mapEmbedUrl               String?             @db.Text
  mapStaticImageUrl         String?             @db.Text
  stageDetails              Json?
  auctionName               String?
  evaluationValue           Decimal?            @db.Decimal(15, 2)
  original_lot_id           String?             @unique
  originalLot               Lot?                @relation("RelistedLots", fields: [original_lot_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  relistedLot               Lot?                @relation("RelistedLots")
  sellerName                String?
  bids                      Bid[]
  assets                    AssetsOnLots[]
  questions                 LotQuestion[]
  reviews                   Review[]
  wins                      UserWin[]
  maxBids                   UserLotMaxBid[]
  installmentPayments       InstallmentPayment[] @relation("_InstallmentPaymentToLot")

  @@unique([auctionId, number])
}

model AssetsOnLots {
  lotId      String
  assetId    String
  assignedAt DateTime @default(now())
  assignedBy String
  lot        Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  asset      Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@id([lotId, assetId])
}

model AuctionStage {
  id           String   @id @default(cuid())
  name         String
  startDate    DateTime @db.DateTime
  endDate      DateTime @db.DateTime
  auctionId    String
  auction      Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  initialPrice Decimal? @db.Decimal(15, 2)

  @@index([auctionId])
}

model Bid {
  id            String   @id @default(cuid())
  amount        Decimal  @db.Decimal(15, 2)
  timestamp     DateTime @default(now())
  bidderDisplay String?
  auctionId     String
  auction       Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  lotId         String
  lot           Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  bidderId      String
  bidder        User     @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([lotId])
  @@index([bidderId])
}

model UserWin {
  id               String               @id @default(cuid())
  winningBidAmount Decimal              @db.Decimal(15, 2)
  winDate          DateTime             @default(now())
  paymentStatus    PaymentStatus        @default(PENDENTE)
  invoiceUrl       String?
  lotId            String               @unique
  lot              Lot                  @relation(fields: [lotId], references: [id])
  userId           String
  user             User                 @relation(fields: [userId], references: [id])
  installments     InstallmentPayment[]

  @@index([userId])
}

model InstallmentPayment {
  id                String        @id @default(cuid())
  amount            Decimal       @db.Decimal(15, 2)
  dueDate           DateTime
  status            PaymentStatus @default(PENDENTE)
  userWinId         String
  userWin           UserWin       @relation(fields: [userWinId], references: [id], onDelete: Cascade)
  installmentNumber Int
  paymentDate       DateTime?
  paymentMethod     String?
  transactionId     String?
  lots              Lot[]         @relation("_InstallmentPaymentToLot")

  @@unique([userWinId, installmentNumber])
  @@index([userWinId])
}

model Review {
  id              String   @id @default(cuid())
  rating          Int
  comment         String?  @db.Text
  createdAt       DateTime @default(now())
  userDisplayName String?
  lotId           String
  lot             Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  auctionId       String
  auction         Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([lotId])
}

model LotQuestion {
  id                        String   @id @default(cuid())
  questionText              String   @db.Text
  answerText                String?  @db.Text
  isPublic                  Boolean  @default(true)
  createdAt                 DateTime @default(now())
  answeredAt                DateTime?
  userDisplayName           String
  answeredByUserDisplayName String?
  lotId                     String
  lot                       Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  auctionId                 String
  auction                   Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  userId                    String
  user                      User     @relation(fields: [userId], references: [id])
  answeredByUserId          String?

  @@index([lotId])
}

model UserDocument {
  id              String           @id @default(cuid())
  status          UserDocumentStatus @default(PENDING_ANALYSIS)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  userId          String
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  documentTypeId  String
  documentType    DocumentType     @relation(fields: [documentTypeId], references: [id])
  fileName        String?
  fileUrl         String
  rejectionReason String?

  @@unique([userId, documentTypeId])
  @@index([userId])
}

model UserLotMaxBid {
  id        String   @id @default(cuid())
  maxAmount Decimal  @db.Decimal(15, 2)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  lotId     String
  lot       Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)

  @@unique([userId, lotId])
  @@index([lotId])
}

model MediaItem {
  id               String           @id @default(cuid())
  fileName         String
  mimeType         String
  sizeBytes        Int?
  storagePath      String
  urlOriginal      String
  urlThumbnail     String?
  urlMedium        String?
  urlLarge         String?
  title            String?
  altText          String?
  caption          String?
  description      String?          @db.Text
  dataAiHint       String?
  uploadedAt       DateTime         @default(now())
  uploadedByUserId String?
  uploadedByUser   User?            @relation("UploadedBy", fields: [uploadedByUserId], references: [id], onDelete: SetNull)
  judicialProcessId String?
  linkedLotIds     Json?
}

model DirectSaleOffer {
  id                   String                @id @default(cuid())
  publicId             String                @unique
  title                String
  description          String?               @db.Text
  offerType            DirectSaleOfferType
  price                Decimal?              @db.Decimal(15, 2)
  minimumOfferPrice    Decimal?              @db.Decimal(15, 2)
  status               DirectSaleOfferStatus @default(ACTIVE)
  locationCity         String?
  locationState        String?
  imageUrl             String?
  imageMediaId         String?
  dataAiHint           String?
  galleryImageUrls     Json?
  mediaItemIds         Json?
  itemsIncluded        Json?
  views                Int                   @default(0)
  expiresAt            DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  tenantId             String
  tenant               Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sellerId             String
  seller               Seller                @relation(fields: [sellerId], references: [id], onDelete: Cascade)
  sellerName           String?
  sellerLogoUrl        String?
  dataAiHintSellerLogo String?
  categoryId           String
  category             LotCategory           @relation(fields: [categoryId], references: [id])
}

model AuctionHabilitation {
  userId        String
  auctionId     String
  habilitatedAt DateTime @default(now())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  auction       Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)

  @@id([userId, auctionId])
  @@index([auctionId])
}

model DataSource {
  id        String @id @default(cuid())
  name      String
  modelName String @unique
  fields    Json

  @@map("data_sources")
}

model Report {
  id          String   @id @default(cuid())
  name        String
  description String?
  definition  Json
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("reports")
}

// =================================================================
// Enums
// =================================================================

enum AssetStatus {
  CADASTRO
  DISPONIVEL
  LOTEADO
  VENDIDO
  REMOVIDO
  INATIVADO
}

enum AuctionStatus {
  RASCUNHO
  EM_PREPARACAO
  EM_BREVE
  ABERTO
  ABERTO_PARA_LANCES
  ENCERRADO
  FINALIZADO
  CANCELADO
  SUSPENSO
}

enum LotStatus {
  RASCUNHO
  EM_BREVE
  ABERTO_PARA_LANCES
  ENCERRADO
  VENDIDO
  NAO_VENDIDO
  RELISTADO
  CANCELADO
  RETIRADO
}

enum UserHabilitationStatus {
  PENDING_DOCUMENTS
  PENDING_ANALYSIS
  HABILITADO
  REJECTED_DOCUMENTS
  REJEITADO
  BLOCKED
}

enum AccountType {
  PHYSICAL
  LEGAL
  DIRECT_SALE_CONSIGNOR
}

enum PaymentStatus {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  REEMBOLSADO
  CANCELADO
  ATRASADO
}

enum DocumentTemplateType {
  WINNING_BID_TERM
  EVALUATION_REPORT
  AUCTION_CERTIFICATE
}

enum UserDocumentStatus {
  NOT_SENT
  SUBMITTED
  PENDING_ANALYSIS
  APPROVED
  REJECTED
}

enum DirectSaleOfferStatus {
  ACTIVE
  PENDING_APPROVAL
  SOLD
  EXPIRED
  RASCUNHO
}

enum DirectSaleOfferType {
  BUY_NOW
  ACCEPTS_PROPOSALS
}

enum AuctionType {
  JUDICIAL
  EXTRAJUDICIAL
  PARTICULAR
  TOMADA_DE_PRECOS
  VENDA_DIRETA
}

enum AuctionMethod {
  STANDARD
  DUTCH
  SILENT
}

enum AuctionParticipation {
  ONLINE
  PRESENCIAL
  HIBRIDO
}

enum ProcessPartyType {
  AUTOR
  REU
  ADVOGADO_AUTOR
  ADVOGADO_REU
  JUIZ
  ESCRIVAO
  PERITO
  ADMINISTRADOR_JUDICIAL
  TERCEIRO_INTERESSADO
  OUTRO
}

enum SearchPaginationType {
  loadMore
  numberedPages
}

// =================================================================
// Many-to-Many Link Tables
// =================================================================

// These tables are defined implicitly by Prisma when you use a
// many-to-many relation syntax (e.g., categories LotCategory[]).
// You only need to define them explicitly if you want to add
// extra fields to the relation itself.

// model _AuctionToCourt {
//   A String
//   B String
//
//   @@unique([A, B])
//   @@index([B])
// }
//
// model _AuctionToJudicialBranch {
//   A String
//   B String
//
//   @@unique([A, B])
//   @@index([B])
// }
//
// model _AuctionToJudicialDistrict {
//   A String
//   B String
//
//   @@unique([A, B])
//   @@index([B])
// }
//
// model _AuctionToLotCategory {
//   A String
//   B String
//
//   @@unique([A, B])
//   @@index([B])
// }
//
// model _InstallmentPaymentToLot {
//   A String
//   B String
//
//   @@unique([A, B])
//   @@index([B])
// }
