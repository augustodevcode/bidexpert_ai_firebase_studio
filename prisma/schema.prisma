// =============================================================================
// PRISMA SCHEMA - SQLITE VERSION (Local Development)
// =============================================================================
// Schema simplificado para desenvolvimento local com SQLite

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Modelos essenciais para testes
model Tenant {
  id        Int      @id @default(autoincrement())
  publicId  String   @unique
  name      String
  slug      String   @unique
  subdomain String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  User              User[]
  Auction           Auction[]
  Lot               Lot[]
  Bid               Bid[]
  Seller            Seller[]
  Auctioneer        Auctioneer[]
  PlatformSettings  PlatformSettings?
}

model User {
  id            Int       @id @default(autoincrement())
  publicId      String    @unique
  email         String    @unique
  name          String?
  password      String?   // Corrigido de passwordHash para password
  role          String    @default("USER")
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenantId      Int

  Tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  Bid           Bid[]
  Lot           Lot[]     @relation("LotWinner")

  @@index([tenantId])
}

model Auction {
  id           Int       @id @default(autoincrement())
  publicId     String?   @unique
  slug         String?   @unique
  title        String
  description  String?
  status       String    @default("RASCUNHO")
  auctionDate  DateTime?
  endDate      DateTime?
  totalLots    Int       @default(0)
  visits       Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenantId     Int
  
  Tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  Lot          Lot[]
  Bid          Bid[]
  
  @@index([tenantId])
}

model Lot {
  id            Int       @id @default(autoincrement())
  publicId      String?   @unique
  auctionId     Int
  number        String?
  title         String
  description   String?
  slug          String?
  price         Float
  initialPrice  Float?
  status        String    @default("EM_BREVE")
  bidsCount     Int       @default(0)
  views         Int       @default(0)
  isFeatured    Boolean   @default(false)
  imageUrl      String?
  type          String
  condition     String?
  winnerId      Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  tenantId      Int
  
  Auction       Auction   @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  Tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User          User?     @relation("LotWinner", fields: [winnerId], references: [id])
  Bid           Bid[]
  
  @@index([auctionId])
  @@index([tenantId])
  @@index([winnerId])
}

model Bid {
  id          Int       @id @default(autoincrement())
  lotId       Int
  auctionId   Int
  bidderId    Int
  amount      Float
  timestamp   DateTime  @default(now())
  status      String    @default("ATIVO")
  isAutoBid   Boolean   @default(false)
  tenantId    Int
  
  Lot         Lot       @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Auction     Auction   @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  User        User      @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  Tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([auctionId])
  @@index([bidderId])
  @@index([lotId])
  @@index([tenantId])
}

model PlatformSettings {
  id              Int       @id @default(autoincrement())
  tenantId        Int       @unique
  siteTitle       String?
  siteTagline     String?
  logoUrl         String?
  isSetupComplete Boolean   @default(false)
  primaryColor    String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  Tenant          Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model LotCategory {
  id          Int       @id @default(autoincrement())
  slug        String    @unique
  name        String    @unique
  description String?
  logoUrl     String?
  isGlobal    Boolean   @default(true)
  createdAt   DateTime? @default(now())
  updatedAt   DateTime?
}

model Seller {
  id          Int       @id @default(autoincrement())
  publicId    String    @unique
  name        String
  slug        String    @unique
  description String?
  logoUrl     String?
  email       String?
  phone       String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  tenantId    Int
  
  Tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
}

model Auctioneer {
  id                 Int       @id @default(autoincrement())
  publicId           String    @unique
  name               String
  slug               String    @unique
  description        String?
  registrationNumber String?
  logoUrl            String?
  email              String?
  phone              String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  tenantId           Int
  
  Tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([tenantId])
}

model ContactMessage {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
}
