// =============================================================================
// PRISMA SCHEMA - MYSQL VERSION (Local Development)
// =============================================================================
// Este schema Ã© usado para desenvolvimento local com MySQL.
// Para deploy no Vercel (PostgreSQL), use schema.postgresql.prisma ou 
// configure o buildCommand no vercel.json para usar o schema correto.
// =============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Asset {
  id                         BigInt                  @id @default(autoincrement())
  publicId                   String                  @unique
  title                      String
  description                String?                 @db.Text
  status                     AssetStatus            @default(DISPONIVEL)
  categoryId                 BigInt?
  subcategoryId              BigInt?
  judicialProcessId          BigInt?
  sellerId                   BigInt?
  evaluationValue            Decimal?                @db.Decimal(15, 2)
  imageUrl                   String?
  imageMediaId               BigInt?
  galleryImageUrls           Json?
  mediaItemIds               Json?
  dataAiHint                 String?
  locationCity               String?
  locationState              String?
  address                    String?
  latitude                   Decimal?
  longitude                  Decimal?
  lotId                      BigInt?
  lotInfo                    String?
  judicialProcessNumber      String?
  createdAt                  DateTime                @default(now())
  updatedAt DateTime @updatedAt
  tenantId                   BigInt
  plate                      String?
  make                       String?
  model                      String?
  version                    String?
  year                       Int?
  modelYear                  Int?
  mileage                    Int?
  color                      String?
  fuelType                   String?
  transmissionType           String?
  bodyType                   String?
  vin                        String?                 @unique
  renavam                    String?                 @unique
  enginePower                String?
  numberOfDoors              Int?
  vehicleOptions             String?                 @db.Text
  detranStatus               String?                 @db.Text
  debts                      String?                 @db.Text
  runningCondition           String?
  bodyCondition              String?
  tiresCondition             String?
  hasKey                     Boolean?
  propertyRegistrationNumber String?
  iptuNumber                 String?
  isOccupied                 Boolean?
  occupationStatus           Asset_occupationStatus?
  occupationNotes            String?                 @db.Text
  occupationLastVerified     DateTime?
  occupationUpdatedBy        BigInt?
  totalArea                  Decimal?
  builtArea                  Decimal?
  bedrooms                   Int?
  suites                     Int?
  bathrooms                  Int?
  parkingSpaces              Int?
  constructionType           String?
  finishes                   String?                 @db.Text
  infrastructure             String?                 @db.Text
  condoDetails               String?                 @db.Text
  improvements               String?                 @db.Text
  topography                 String?
  liensAndEncumbrances       String?                 @db.Text
  propertyDebts              String?                 @db.Text
  unregisteredRecords        String?                 @db.Text
  hasHabiteSe                Boolean?
  zoningRestrictions         String?
  amenities                  Json?
  brand                      String?
  serialNumber               String?
  itemCondition              String?
  specifications             String?                 @db.Text
  includedAccessories        String?                 @db.Text
  batteryCondition           String?
  hasInvoice                 Boolean?
  hasWarranty                Boolean?
  repairHistory              String?                 @db.Text
  applianceCapacity          String?
  voltage                    String?
  applianceType              String?
  additionalFunctions        String?
  hoursUsed                  Int?
  engineType                 String?
  capacityOrPower            String?
  maintenanceHistory         String?                 @db.Text
  installationLocation       String?
  compliesWithNR             String?
  operatingLicenses          String?
  breed                      String?
  age                        String?
  sex                        String?
  weight                     String?
  individualId               String?
  purpose                    String?
  sanitaryCondition          String?                 @db.Text
  lineage                    String?
  isPregnant                 Boolean?
  specialSkills              String?
  gtaDocument                String?
  breedRegistryDocument      String?
  furnitureType              String?
  material                   String?
  style                      String?
  dimensions                 String?
  pieceCount                 Int?
  jewelryType                String?
  metal                      String?
  gemstones                  String?
  totalWeight                String?
  jewelrySize                String?
  authenticityCertificate    String?
  workType                   String?
  artist                     String?
  period                     String?
  technique                  String?
  provenance                 String?                 @db.Text
  boatType                   String?
  boatLength                 String?
  hullMaterial               String?
  onboardEquipment           String?                 @db.Text
  productName                String?
  quantity                   String?
  packagingType              String?
  expirationDate             DateTime?
  storageConditions          String?
  preciousMetalType          String?
  purity                     String?
  forestGoodsType            String?
  volumeOrQuantity           String?
  species                    String?
  dofNumber                  String?
  LotCategory                LotCategory?            @relation(fields: [categoryId], references: [id])
  JudicialProcess            JudicialProcess?        @relation(fields: [judicialProcessId], references: [id])
  User                       User?                   @relation(fields: [occupationUpdatedBy], references: [id])
  Seller                     Seller?                 @relation(fields: [sellerId], references: [id])
  Subcategory                Subcategory?            @relation(fields: [subcategoryId], references: [id])
  Tenant                     Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  AssetMedia                 AssetMedia[]
  AssetsOnLots               AssetsOnLots[]

  @@index([categoryId])
  @@index([judicialProcessId])
  @@index([occupationUpdatedBy], map: "Asset_occupationUpdatedBy_idx")
  @@index([sellerId])
  @@index([subcategoryId])
  @@index([tenantId])
}

model AssetMedia {
  id           BigInt    @id @default(autoincrement())
  assetId      BigInt
  mediaItemId  BigInt
  isPrimary    Boolean   @default(false)
  displayOrder Int       @default(0)
  tenantId     BigInt
  Asset        Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)
  MediaItem    MediaItem @relation(fields: [mediaItemId], references: [id], onDelete: Cascade)
  Tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([mediaItemId])
  @@index([tenantId])
}

model AssetsOnLots {
  lotId      BigInt
  assetId    BigInt
  assignedAt DateTime @default(now())
  assignedBy String
  tenantId   BigInt
  Asset      Asset    @relation(fields: [assetId], references: [id])
  Lot        Lot      @relation(fields: [lotId], references: [id])
  Tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@id([lotId, assetId])
  @@index([assetId])
  @@index([tenantId])
}

model Auction {
  id                       BigInt                 @id @default(autoincrement())
  publicId                 String?                @unique
  slug                     String?                @unique
  title                    String
  description              String?                @db.Text
  status                   AuctionStatus         @default(RASCUNHO)
  auctionDate              DateTime?
  endDate                  DateTime?
  totalLots                Int                    @default(0)
  visits                   Int                    @default(0)
  totalHabilitatedUsers    Int                    @default(0)
  initialOffer             Decimal?               @db.Decimal(15, 2)
  auctionType              Auction_auctionType?
  auctionMethod            Auction_auctionMethod? @default(STANDARD)
  participation            Auction_participation? @default(ONLINE)
  
  // State Machine Fields
  createdByUserId      BigInt?
  submittedAt          DateTime?
  validatedAt          DateTime?
  validatedBy          BigInt?
  validationNotes      String?                @db.Text
  openDate             DateTime?
  actualOpenDate       DateTime?
  closedAt             DateTime?
  cancelledAt          DateTime?
  cancelledBy          BigInt?
  cancellationReason   String?                @db.Text

  onlineUrl                String?                @db.VarChar(500)
  address                  String?
  zipCode                  String?                @db.VarChar(10)
  latitude                 Decimal?               @db.Decimal(10, 8)
  longitude                Decimal?               @db.Decimal(11, 8)
  documentsUrl             String?                @db.VarChar(500)
  isFeaturedOnMarketplace  Boolean                @default(false)
  softCloseEnabled         Boolean?               @default(false)
  softCloseMinutes         Int?
  achievedRevenue          Decimal?               @db.Decimal(15, 2)
  evaluationReportUrl      String?                @db.VarChar(500)
  auctionCertificateUrl    String?                @db.VarChar(500)
  floorPrice               Decimal?               @db.Decimal(15, 2)
  decrementAmount          Decimal?               @db.Decimal(10, 2)
  decrementIntervalSeconds Int?
  sellingBranch            String?
  additionalTriggers       Json?
  createdAt                DateTime               @default(now())
  updatedAt DateTime @updatedAt
  tenantId                 BigInt
  auctioneerId             BigInt?
  sellerId                 BigInt?
  imageMediaId             BigInt?
  isRelisted               Boolean                @default(false)
  relistCount              Int                    @default(0)
  originalAuctionId        BigInt?                @unique
  cityId                   BigInt?
  stateId                  BigInt?
  judicialProcessId        BigInt?
  categoryId               BigInt?
  complement               String?                @db.VarChar(100)
  neighborhood             String?                @db.VarChar(100)
  number                   String?                @db.VarChar(20)
  street                   String?                @db.VarChar(255)
  supportPhone             String?                @db.VarChar(50)
  supportEmail             String?                @db.VarChar(255)
  supportWhatsApp          String?                @db.VarChar(50)
  Auctioneer               Auctioneer?            @relation(fields: [auctioneerId], references: [id])
  LotCategory              LotCategory?           @relation(fields: [categoryId], references: [id])
  City                     City?                  @relation(fields: [cityId], references: [id])
  JudicialProcess          JudicialProcess?       @relation(fields: [judicialProcessId], references: [id])
  Auction                  Auction?               @relation("AuctionToAuction", fields: [originalAuctionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_Auction            Auction?               @relation("AuctionToAuction")
  Seller                   Seller?                @relation(fields: [sellerId], references: [id])
  State                    State?                 @relation(fields: [stateId], references: [id])
  Tenant                   Tenant                 @relation(fields: [tenantId], references: [id])
  AuctionHabilitation      AuctionHabilitation[]
  AuctionStage             AuctionStage[]
  Bid                      Bid[]
  Lot                      Lot[]
  LotQuestion              LotQuestion[]
  LotStagePrice            LotStagePrice[]
  Notification             Notification[]
  Review                   Review[]
  Court                    Court[]
  JudicialBranch           JudicialBranch[]
  JudicialDistrict         JudicialDistrict[]

  @@index([auctioneerId])
  @@index([categoryId])
  @@index([cityId])
  @@index([judicialProcessId])
  @@index([sellerId])
  @@index([stateId])
  @@index([tenantId])
}

model AuctionHabilitation {
  userId        BigInt
  auctionId     BigInt
  habilitatedAt DateTime @default(now())
  tenantId      BigInt
  Auction       Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  Tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, auctionId])
  @@index([auctionId])
  @@index([tenantId])
}

model AuctionStage {
  id              BigInt              @id @default(autoincrement())
  name            String
  startDate       DateTime
  endDate         DateTime
  auctionId       BigInt
  status          AuctionStage_status @default(AGUARDANDO_INICIO)
  tenantId        BigInt
  discountPercent Decimal             @default(100.00) @db.Decimal(5, 2)
  Auction         Auction             @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  Tenant          Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  LotStagePrice   LotStagePrice[]

  @@index([auctionId])
  @@index([tenantId])
}

model Auctioneer {
  id                 BigInt    @id @default(autoincrement())
  publicId           String    @unique
  name               String
  slug               String    @unique
  description        String?   @db.Text
  registrationNumber String?
  logoUrl            String?   @db.Text
  logoMediaId        BigInt?
  dataAiHintLogo     String?
  website            String?   @db.Text
  email              String?
  phone              String?
  supportWhatsApp    String?
  contactName        String?
  address            String?
  city               String?
  state              String?
  zipCode            String?
  street             String?
  number             String?
  complement         String?
  neighborhood       String?
  cityId             BigInt?
  stateId            BigInt?
  latitude           Decimal?
  longitude          Decimal?
  createdAt          DateTime  @default(now())
  updatedAt DateTime @updatedAt
  tenantId           BigInt
  userId             BigInt?   @unique
  Auction            Auction[]
  Tenant             Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User               User?     @relation(fields: [userId], references: [id])
  Lot                Lot[]

  @@index([tenantId])
}

model Bid {
  id            BigInt     @id @default(autoincrement())
  lotId         BigInt
  auctionId     BigInt
  bidderId      BigInt
  amount        Decimal    @db.Decimal(15, 2)
  timestamp     DateTime   @default(now())
  
  // Status Fields
  status        BidStatus @default(ATIVO)
  cancelledAt   DateTime?
  isAutoBid     Boolean    @default(false)
  
  bidderDisplay String?
  tenantId      BigInt
  Auction       Auction    @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  User          User       @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  Lot           Lot        @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant        Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([auctionId])
  @@index([bidderId])
  @@index([lotId])
  @@index([tenantId])
}

model BiddingSettings {
  id                              BigInt           @id @default(autoincrement())
  platformSettingsId              BigInt           @unique
  instantBiddingEnabled           Boolean?         @default(true)
  getBidInfoInstantly             Boolean?         @default(true)
  biddingInfoCheckIntervalSeconds Int?             @default(1)
  defaultStageDurationDays        Int?             @default(7)
  defaultDaysBetweenStages        Int?             @default(1)
  PlatformSettings                PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model City {
  id        BigInt    @id @default(autoincrement())
  name      String
  stateId   BigInt
  ibgeCode  String?   @unique
  slug      String?
  lotCount  Int?      @default(0)
  createdAt DateTime? @default(now())
  updatedAt DateTime?
  Auction   Auction[]
  State     State     @relation(fields: [stateId], references: [id])
  Lot       Lot[]

  @@unique([name, stateId])
  @@index([stateId])
}

model ContactMessage {
  id        BigInt   @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model CounterState {
  id           BigInt   @id @default(autoincrement())
  tenantId     BigInt
  entityType   String
  currentValue Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tenantId, entityType])
  @@index([tenantId])
}

model Court {
  id               BigInt             @id @default(autoincrement())
  slug             String             @unique
  name             String
  stateUf          String
  website          String?
  createdAt        DateTime           @default(now())
  updatedAt DateTime @updatedAt
  JudicialDistrict JudicialDistrict[]
  JudicialProcess  JudicialProcess[]
  Auction          Auction[]
}

model DataSource {
  id        BigInt @id @default(autoincrement())
  name      String
  modelName String @unique
  fields    Json
}

model DirectSaleOffer {
  id                   BigInt                    @id @default(autoincrement())
  publicId             String                    @unique
  title                String
  description          String?                   @db.Text
  offerType            DirectSaleOffer_offerType
  price                Decimal?                  @db.Decimal(15, 2)
  minimumOfferPrice    Decimal?                  @db.Decimal(15, 2)
  status               DirectSaleOffer_status    @default(ACTIVE)
  locationCity         String?
  locationState        String?
  imageUrl             String?
  imageMediaId         BigInt?
  dataAiHint           String?
  galleryImageUrls     Json?
  mediaItemIds         Json?
  expiresAt            DateTime?
  createdAt            DateTime                  @default(now())
  updatedAt DateTime @updatedAt
  categoryId           BigInt
  sellerId             BigInt
  sellerName           String?
  sellerLogoUrl        String?
  dataAiHintSellerLogo String?
  tenantId             BigInt
  itemsIncluded        Json?
  views                Int                       @default(0)
  LotCategory          LotCategory               @relation(fields: [categoryId], references: [id])
  Seller               Seller                    @relation(fields: [sellerId], references: [id])
  Tenant               Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([categoryId])
  @@index([sellerId])
  @@index([tenantId])
}

model DocumentTemplate {
  id        BigInt                @id @default(autoincrement())
  name      String                @unique
  type      DocumentTemplate_type
  content   String?               @db.Text
  createdAt DateTime              @default(now())
  updatedAt DateTime @updatedAt
}

model DocumentType {
  id           BigInt         @id @default(autoincrement())
  name         String         @unique
  description  String?
  isRequired   Boolean        @default(true)
  appliesTo    String
  UserDocument UserDocument[]
}

model IdMasks {
  id                  BigInt           @id @default(autoincrement())
  platformSettingsId  BigInt           @unique
  auctionCodeMask     String?
  lotCodeMask         String?
  sellerCodeMask      String?
  auctioneerCodeMask  String?
  userCodeMask        String?
  assetCodeMask       String?
  categoryCodeMask    String?
  subcategoryCodeMask String?
  PlatformSettings    PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model InstallmentPayment {
  id                BigInt                    @id @default(autoincrement())
  userWinId         BigInt
  installmentNumber Int
  totalInstallments Int
  amount            Decimal                   @db.Decimal(15, 2)
  dueDate           DateTime
  paymentDate       DateTime?
  status            InstallmentPayment_status @default(PENDENTE)
  paymentMethod     String?
  transactionId     String?
  tenantId          BigInt
  Tenant            Tenant                    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  UserWin           UserWin                   @relation(fields: [userWinId], references: [id], onDelete: Cascade)
  Lot               Lot[]

  @@unique([userWinId, installmentNumber])
  @@index([tenantId])
  @@index([userWinId])
}

model JudicialBranch {
  id               BigInt            @id @default(autoincrement())
  slug             String            @unique
  name             String            @unique
  districtId       BigInt?
  contactName      String?
  phone            String?
  email            String?
  createdAt        DateTime          @default(now())
  updatedAt DateTime @updatedAt
  JudicialDistrict JudicialDistrict? @relation(fields: [districtId], references: [id])
  JudicialProcess  JudicialProcess[]
  Seller           Seller?
  Auction          Auction[]

  @@index([districtId])
}

model JudicialDistrict {
  id              BigInt            @id @default(autoincrement())
  slug            String            @unique
  name            String            @unique
  courtId         BigInt?
  stateId         BigInt?
  zipCode         String?
  createdAt       DateTime          @default(now())
  updatedAt DateTime @updatedAt
  JudicialBranch  JudicialBranch[]
  Court           Court?            @relation(fields: [courtId], references: [id])
  State           State?            @relation(fields: [stateId], references: [id])
  JudicialProcess JudicialProcess[]
  Auction         Auction[]

  @@index([courtId])
  @@index([stateId])
}

model JudicialParty {
  id              BigInt                  @id @default(autoincrement())
  name            String
  documentNumber  String?
  partyType       JudicialParty_partyType
  processId       BigInt
  tenantId        BigInt
  JudicialProcess JudicialProcess         @relation(fields: [processId], references: [id], onDelete: Cascade)
  Tenant          Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([processId])
  @@index([tenantId])
}

model JudicialProcess {
  id                         BigInt                      @id @default(autoincrement())
  publicId                   String                      @unique
  processNumber              String
  isElectronic               Boolean                     @default(true)
  createdAt                  DateTime?                   @default(now())
  updatedAt                  DateTime?
  tenantId                   BigInt
  courtId                    BigInt?
  districtId                 BigInt?
  branchId                   BigInt?
  sellerId                   BigInt?
  propertyMatricula          String?                     @db.VarChar(50)
  propertyRegistrationNumber String?
  actionType                 JudicialProcess_actionType?
  actionDescription          String?
  actionCnjCode              String?                     @db.VarChar(20)
  Asset                      Asset[]
  Auction                    Auction[]
  JudicialParty              JudicialParty[]
  JudicialBranch             JudicialBranch?             @relation(fields: [branchId], references: [id])
  Court                      Court?                      @relation(fields: [courtId], references: [id])
  JudicialDistrict           JudicialDistrict?           @relation(fields: [districtId], references: [id])
  Seller                     Seller?                     @relation(fields: [sellerId], references: [id])
  Tenant                     Tenant                      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  MediaItem                  MediaItem[]
  Lot                        Lot[]

  @@unique([processNumber, tenantId])
  @@index([actionType])
  @@index([branchId])
  @@index([courtId])
  @@index([districtId])
  @@index([propertyMatricula])
  @@index([propertyRegistrationNumber])
  @@index([sellerId])
  @@index([tenantId])
}

model Lot {
  id                       BigInt               @id @default(autoincrement())
  publicId                 String?              @unique
  auctionId                BigInt
  number                   String?
  title                    String
  description              String?              @db.Text
  slug                     String?
  price                    Decimal              @db.Decimal(15, 2)
  initialPrice             Decimal?             @db.Decimal(15, 2)
  secondInitialPrice       Decimal?             @db.Decimal(15, 2)
  bidIncrementStep         Decimal?             @db.Decimal(10, 2)
  status                   LotStatus           @default(EM_BREVE)
  
  // State Machine Fields
  openedAt                 DateTime?
  lotClosedAt              DateTime?
  soldAt                   DateTime?
  soldPrice                Decimal?             @db.Decimal(15, 2)
  
  bidsCount                Int?                 @default(0)
  views                    Int?                 @default(0)
  isFeatured               Boolean?             @default(false)
  isExclusive              Boolean?             @default(false)
  discountPercentage       Int?
  additionalTriggers       Json?
  imageUrl                 String?              @db.Text
  imageMediaId             BigInt?
  galleryImageUrls         Json?
  mediaItemIds             Json?
  stageDetails             Json?
  type                     String
  condition                String?
  dataAiHint               String?
  winnerId                 BigInt?
  winningBidTermUrl        String?
  allowInstallmentBids     Boolean?             @default(false)
  isRelisted               Boolean              @default(false)
  relistCount              Int                  @default(0)
  original_lot_id          BigInt?              @unique
  createdAt                DateTime             @default(now())
  updatedAt DateTime @updatedAt
  endDate                  DateTime?
  lotSpecificAuctionDate   DateTime?
  secondAuctionDate        DateTime?
  categoryId               BigInt?
  subcategoryId            BigInt?
  sellerId                 BigInt?
  auctioneerId             BigInt?
  cityId                   BigInt?
  stateId                  BigInt?
  cityName                 String?
  stateUf                  String?
  latitude                 Decimal?
  longitude                Decimal?
  mapAddress               String?
  tenantId                 BigInt
  depositGuaranteeAmount   Decimal?             @db.Decimal(15, 2)
  depositGuaranteeInfo     String?              @db.Text
  requiresDepositGuarantee Boolean?             @default(false)
  AssetsOnLots             AssetsOnLots[]
  Bid                      Bid[]
  Auction                  Auction              @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  Auctioneer               Auctioneer?          @relation(fields: [auctioneerId], references: [id])
  LotCategory              LotCategory?         @relation(fields: [categoryId], references: [id])
  City                     City?                @relation(fields: [cityId], references: [id])
  Lot                      Lot?                 @relation("LotToLot", fields: [original_lot_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_Lot                Lot?                 @relation("LotToLot")
  Seller                   Seller?              @relation(fields: [sellerId], references: [id])
  State                    State?               @relation(fields: [stateId], references: [id])
  Subcategory              Subcategory?         @relation(fields: [subcategoryId], references: [id])
  Tenant                   Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User                     User?                @relation(fields: [winnerId], references: [id])
  LotDocument              LotDocument[]
  LotQuestion              LotQuestion[]
  LotRisk                  LotRisk[]
  LotStagePrice            LotStagePrice[]
  Notification             Notification[]
  Review                   Review[]
  UserLotMaxBid            UserLotMaxBid[]
  UserWin                  UserWin?
  InstallmentPayment       InstallmentPayment[]
  JudicialProcess          JudicialProcess[]

  @@unique([auctionId, number])
  @@index([auctioneerId])
  @@index([categoryId])
  @@index([cityId])
  @@index([sellerId])
  @@index([stateId])
  @@index([subcategoryId])
  @@index([tenantId])
  @@index([winnerId])
}

model LotCategory {
  id                   BigInt            @id @default(autoincrement())
  slug                 String            @unique
  name                 String            @unique
  description          String?           @db.Text
  logoUrl              String?
  logoMediaId          BigInt?
  dataAiHintLogo       String?
  coverImageUrl        String?
  coverImageMediaId    BigInt?
  dataAiHintCover      String?
  megaMenuImageUrl     String?
  megaMenuImageMediaId BigInt?
  dataAiHintMegaMenu   String?
  hasSubcategories     Boolean?          @default(false)
  isGlobal             Boolean           @default(true)
  tenantId             BigInt?
  createdAt            DateTime?         @default(now())
  updatedAt            DateTime?
  Asset                Asset[]
  Auction              Auction[]
  DirectSaleOffer      DirectSaleOffer[]
  Lot                  Lot[]
  Tenant               Tenant?           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  Subcategory          Subcategory[]

  @@index([tenantId])
}

model LotDocument {
  id           BigInt   @id @default(autoincrement())
  lotId        BigInt
  fileName     String
  title        String
  description  String?  @db.Text
  fileUrl      String   @db.Text
  fileSize     BigInt?
  mimeType     String?
  displayOrder Int      @default(0)
  isPublic     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenantId     BigInt
  Lot          Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([lotId])
  @@index([tenantId])
}

model LotQuestion {
  id                        BigInt    @id @default(autoincrement())
  lotId                     BigInt
  auctionId                 BigInt
  userId                    BigInt
  userDisplayName           String
  questionText              String    @db.Text
  answerText                String?   @db.Text
  isPublic                  Boolean   @default(true)
  createdAt                 DateTime  @default(now())
  answeredAt                DateTime?
  answeredByUserId          BigInt?
  answeredByUserDisplayName String?
  tenantId                  BigInt
  Auction                   Auction   @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  Lot                       Lot       @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant                    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User                      User      @relation(fields: [userId], references: [id])

  @@index([auctionId])
  @@index([lotId])
  @@index([tenantId])
  @@index([userId])
}

model LotRisk {
  id                 BigInt            @id @default(autoincrement())
  lotId              BigInt
  riskType           LotRisk_riskType
  riskLevel          LotRisk_riskLevel
  riskDescription    String            @db.Text
  mitigationStrategy String?           @db.Text
  verified           Boolean           @default(false)
  verifiedBy         BigInt?
  verifiedAt         DateTime?
  createdAt          DateTime          @default(now())
  updatedAt DateTime @updatedAt
  tenantId           BigInt
  Lot                Lot               @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User               User?             @relation(fields: [verifiedBy], references: [id])

  @@index([lotId])
  @@index([riskLevel])
  @@index([riskType])
  @@index([tenantId])
  @@index([verifiedBy], map: "LotRisk_verifiedBy_idx")
}

model LotStagePrice {
  id             BigInt       @id @default(autoincrement())
  lotId          BigInt
  auctionId      BigInt
  auctionStageId BigInt
  initialBid     Decimal?     @db.Decimal(15, 2)
  bidIncrement   Decimal?     @db.Decimal(10, 2)
  tenantId       BigInt
  Auction        Auction      @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  AuctionStage   AuctionStage @relation(fields: [auctionStageId], references: [id], onDelete: Cascade)
  Lot            Lot          @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([lotId, auctionStageId])
  @@index([auctionId])
  @@index([auctionStageId])
  @@index([tenantId])
}

model MapSettings {
  id                 BigInt           @id @default(autoincrement())
  platformSettingsId BigInt           @unique
  defaultProvider    String?          @default("openstreetmap")
  googleMapsApiKey   String?
  PlatformSettings   PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model MediaItem {
  id                BigInt             @id @default(autoincrement())
  fileName          String
  storagePath       String
  urlOriginal       String
  urlThumbnail      String?
  urlMedium         String?
  urlLarge          String?
  mimeType          String
  sizeBytes         Int?
  altText           String?
  caption           String?
  description       String?            @db.Text
  title             String?
  dataAiHint        String?
  uploadedAt        DateTime           @default(now())
  uploadedByUserId  BigInt?
  judicialProcessId BigInt?
  linkedLotIds      Json?
  tenantId          BigInt?
  AssetMedia        AssetMedia[]
  JudicialProcess   JudicialProcess?   @relation(fields: [judicialProcessId], references: [id])
  Tenant            Tenant?            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploadedBy        User?              @relation(fields: [uploadedByUserId], references: [id])
  PlatformSettings  PlatformSettings[]

  @@index([judicialProcessId])
  @@index([tenantId])
  @@index([uploadedByUserId])
}

model MentalTriggerSettings {
  id                      BigInt           @id @default(autoincrement())
  platformSettingsId      BigInt           @unique
  showDiscountBadge       Boolean          @default(true)
  showPopularityBadge     Boolean          @default(true)
  popularityViewThreshold Int              @default(500)
  showHotBidBadge         Boolean          @default(true)
  hotBidThreshold         Int              @default(10)
  showExclusiveBadge      Boolean          @default(true)
  PlatformSettings        PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model Notification {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  lotId     BigInt?
  auctionId BigInt?
  tenantId  BigInt
  Auction   Auction? @relation(fields: [auctionId], references: [id])
  Lot       Lot?     @relation(fields: [lotId], references: [id])
  Tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([auctionId])
  @@index([lotId])
  @@index([tenantId])
  @@index([userId])
}

model NotificationSettings {
  id                        BigInt           @id @default(autoincrement())
  platformSettingsId        BigInt           @unique
  notifyOnNewAuction        Boolean          @default(true)
  notifyOnFeaturedLot       Boolean          @default(false)
  notifyOnAuctionEndingSoon Boolean          @default(true)
  notifyOnPromotions        Boolean          @default(true)
  PlatformSettings          PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model PasswordResetToken {
  id        BigInt   @id @default(autoincrement())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
}

model PaymentGatewaySettings {
  id                           BigInt           @id @default(autoincrement())
  platformSettingsId           BigInt           @unique
  defaultGateway               String?          @default("Manual")
  platformCommissionPercentage Float?           @default(5)
  gatewayApiKey                String?
  gatewayEncryptionKey         String?
  PlatformSettings             PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model PlatformSettings {
  id                         BigInt                                 @id @default(autoincrement())
  tenantId                   BigInt                                 @unique
  siteTitle                  String?
  siteTagline                String?
  logoUrl                    String?
  faviconUrl                 String?
  isSetupComplete            Boolean                                @default(false)
  primaryColorHsl            String?                                @db.VarChar(50)
  primaryForegroundHsl       String?                                @db.VarChar(50)
  secondaryColorHsl          String?                                @db.VarChar(50)
  secondaryForegroundHsl     String?                                @db.VarChar(50)
  accentColorHsl             String?                                @db.VarChar(50)
  accentForegroundHsl        String?                                @db.VarChar(50)
  destructiveColorHsl        String?                                @db.VarChar(50)
  mutedColorHsl              String?                                @db.VarChar(50)
  backgroundColorHsl         String?                                @db.VarChar(50)
  foregroundColorHsl         String?                                @db.VarChar(50)
  borderColorHsl             String?                                @db.VarChar(50)
  radiusValue                String?                                @db.VarChar(20)
  customCss                  String?                                @db.Text
  customHeadScripts          String?                                @db.Text
  customFontUrl              String?                                @db.Text
  emailFromName              String?                                @db.VarChar(100)
  emailFromAddress           String?                                @db.VarChar(255)
  smsFromName                String?                                @db.VarChar(50)
  enableBlockchain           Boolean                                @default(false)
  enableRealtime             Boolean                                @default(true)
  enableSoftClose            Boolean                                @default(true)
  enableDirectSales          Boolean                                @default(true)
  enableMapSearch            Boolean                                @default(true)
  enableAIFeatures           Boolean                                @default(false)
  crudFormMode               String?                                @default("modal")
  galleryImageBasePath       String?
  storageProvider            PlatformSettings_storageProvider?
  firebaseStorageBucket      String?
  activeThemeName            String?
  searchPaginationType       PlatformSettings_searchPaginationType?
  searchItemsPerPage         Int?                                   @default(12)
  searchLoadMoreCount        Int?                                   @default(12)
  showCountdownOnLotDetail   Boolean?                               @default(true)
  showCountdownOnCards       Boolean?                               @default(true)
  showRelatedLotsOnLotDetail Boolean?                               @default(true)
  relatedLotsCount           Int?                                   @default(5)
  defaultUrgencyTimerHours   Int?
  defaultListItemsPerPage    Int?                                   @default(10)
  marketingSiteAdsSuperOpportunitiesEnabled Boolean                 @default(true)
  marketingSiteAdsSuperOpportunitiesScrollIntervalSeconds Int?      @default(6)
  marketingSiteAdsSuperOpportunitiesDaysBeforeClosing Int?          @default(7)
  auditTrailConfig           Json?
  updatedAt                  DateTime?
  supportAddress             String?
  supportBusinessHours       String?
  supportEmail               String?
  supportPhone               String?
  supportWhatsApp            String?
  logoMediaId                BigInt?
  themeColorsDark            Json?
  themeColorsLight           Json?
  BiddingSettings            BiddingSettings?
  IdMasks                    IdMasks?
  MapSettings                MapSettings?
  MentalTriggerSettings      MentalTriggerSettings?
  NotificationSettings       NotificationSettings?
  PaymentGatewaySettings     PaymentGatewaySettings?
  MediaItem                  MediaItem?                             @relation(fields: [logoMediaId], references: [id])
  Tenant                     Tenant                                 @relation("TenantSettings", fields: [tenantId], references: [id], onDelete: Cascade)
  RealtimeSettings           RealtimeSettings?
  SectionBadgeVisibility     SectionBadgeVisibility?
  ThemeSettings              ThemeSettings[]
  VariableIncrementRule      VariableIncrementRule[]

  @@index([logoMediaId], map: "PlatformSettings_logoMediaId_idx")
}

model RealtimeSettings {
  id                        BigInt           @id @default(autoincrement())
  platformSettingsId        BigInt           @unique
  blockchainEnabled         Boolean          @default(false)
  blockchainNetwork         String           @default("NONE")
  softCloseEnabled          Boolean          @default(false)
  softCloseMinutes          Int              @default(5)
  lawyerPortalEnabled       Boolean          @default(true)
  lawyerMonetizationModel   String           @default("SUBSCRIPTION")
  lawyerSubscriptionPrice   Int?
  lawyerPerUsePrice         Int?
  lawyerRevenueSharePercent Decimal?         @db.Decimal(5, 2)
  PlatformSettings          PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model Report {
  id          BigInt   @id @default(autoincrement())
  name        String
  description String?
  definition  Json
  tenantId    BigInt
  createdAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdById BigInt
  User        User     @relation(fields: [createdById], references: [id])
  Tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([tenantId])
}

model Review {
  id              BigInt   @id @default(autoincrement())
  lotId           BigInt
  auctionId       BigInt
  userId          BigInt
  rating          Int
  comment         String?  @db.Text
  createdAt       DateTime @default(now())
  userDisplayName String?
  tenantId        BigInt
  Auction         Auction  @relation(fields: [auctionId], references: [id], onDelete: Cascade)
  Lot             Lot      @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([auctionId])
  @@index([lotId])
  @@index([tenantId])
  @@index([userId])
}

model Role {
  id             BigInt         @id @default(autoincrement())
  name           String         @unique
  nameNormalized String         @unique
  description    String?
  permissions    Json?
  UsersOnRoles   UsersOnRoles[]
}

model SectionBadgeVisibility {
  id                 BigInt           @id @default(autoincrement())
  platformSettingsId BigInt           @unique
  searchGrid         Json?
  lotDetail          Json?
  PlatformSettings   PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)
}

model Seller {
  id               BigInt            @id @default(autoincrement())
  publicId         String            @unique
  name             String            @unique
  description      String?           @db.Text
  logoUrl          String?           @db.Text
  logoMediaId      BigInt?
  dataAiHintLogo   String?
  website          String?           @db.Text
  email            String?           @db.Text
  phone            String?           @db.Text
  contactName      String?
  address          String?           @db.Text
  city             String?
  state            String?
  zipCode          String?
  street           String?
  number           String?
  complement       String?
  neighborhood     String?
  cityId           BigInt?
  stateId          BigInt?
  latitude         Decimal?
  longitude        Decimal?
  slug             String            @unique
  isJudicial       Boolean           @default(false)
  judicialBranchId BigInt?           @unique
  createdAt        DateTime          @default(now())
  updatedAt DateTime @updatedAt
  tenantId         BigInt
  userId           BigInt?           @unique
  Asset            Asset[]
  Auction          Auction[]
  DirectSaleOffer  DirectSaleOffer[]
  JudicialProcess  JudicialProcess[]
  Lot              Lot[]
  JudicialBranch   JudicialBranch?   @relation(fields: [judicialBranchId], references: [id])
  Tenant           Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User             User?             @relation(fields: [userId], references: [id])

  @@index([tenantId])
}

model State {
  id               BigInt             @id @default(autoincrement())
  slug             String             @unique
  name             String
  uf               String             @unique
  Auction          Auction[]
  City             City[]
  JudicialDistrict JudicialDistrict[]
  Lot              Lot[]
}

model Subcategory {
  id               BigInt      @id @default(autoincrement())
  name             String
  slug             String
  description      String?
  parentCategoryId BigInt
  displayOrder     Int         @default(0)
  iconUrl          String?
  iconMediaId      BigInt?
  dataAiHintIcon   String?
  isGlobal         Boolean     @default(true)
  tenantId         BigInt?
  Asset            Asset[]
  Lot              Lot[]
  LotCategory      LotCategory @relation(fields: [parentCategoryId], references: [id], onDelete: Cascade)
  Tenant           Tenant?     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([name, parentCategoryId])
  @@index([parentCategoryId])
  @@index([tenantId])
}

model Subscriber {
  id          BigInt   @id @default(autoincrement())
  email       String
  name        String?
  phone       String?
  preferences Json?
  createdAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenantId    BigInt
  Tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([email, tenantId])
  @@index([tenantId])
}

model Tenant {
  id                      BigInt                    @id @default(autoincrement())
  name                    String
  subdomain               String                    @unique
  domain                  String?                   @unique
  resolutionStrategy      Tenant_resolutionStrategy @default(SUBDOMAIN)
  customDomainVerified    Boolean                   @default(false)
  customDomainVerifyToken String?                   @db.VarChar(64)
  status                  TenantStatus             @default(PENDING)
  trialStartedAt          DateTime?
  trialExpiresAt          DateTime?
  activatedAt             DateTime?
  suspendedAt             DateTime?
  suspendedReason         String?
  planId                  String?                   @db.VarChar(50)
  maxUsers                Int?                      @default(5)
  maxStorageBytes         BigInt?                   @default(1073741824)
  maxAuctions             Int?                      @default(10)
  externalId              String?                   @unique @db.VarChar(100)
  apiKey                  String?                   @unique @db.VarChar(64)
  webhookUrl              String?                   @db.Text
  webhookSecret           String?                   @db.VarChar(64)
  metadata                Json?
  createdAt               DateTime                  @default(now())
  updatedAt DateTime @updatedAt
  Asset                   Asset[]
  AssetMedia              AssetMedia[]
  AssetsOnLots            AssetsOnLots[]
  Auction                 Auction[]
  AuctionHabilitation     AuctionHabilitation[]
  AuctionStage            AuctionStage[]
  Auctioneer              Auctioneer[]
  Bid                     Bid[]
  DirectSaleOffer         DirectSaleOffer[]
  InstallmentPayment      InstallmentPayment[]
  JudicialParty           JudicialParty[]
  JudicialProcess         JudicialProcess[]
  Lot                     Lot[]
  LotCategory             LotCategory[]
  LotDocument             LotDocument[]
  LotQuestion             LotQuestion[]
  LotRisk                 LotRisk[]
  LotStagePrice           LotStagePrice[]
  MediaItem               MediaItem[]
  Notification            Notification[]
  settings                PlatformSettings? @relation("TenantSettings")
  Report                  Report[]
  Review                  Review[]
  Seller                  Seller[]
  Subcategory             Subcategory[]
  Subscriber              Subscriber[]
  TenantInvoice           TenantInvoice[]
  UserDocument            UserDocument[]
  UserLotMaxBid           UserLotMaxBid[]
  UserWin                 UserWin[]
  UsersOnTenants          UserOnTenant[]
  AuditLog              AuditLog[]
  BidderNotification    BidderNotification[]
  BidderProfile         BidderProfile[]
  FormSubmission        FormSubmission[]
  ITSM_ChatLog          ITSM_ChatLog[]
  ITSM_Ticket            ITSM_Ticket[]
  ParticipationHistory   ParticipationHistory[]
  PaymentMethod         PaymentMethod[]
  WonLot                WonLot[]
}

model TenantInvoice {
  id               BigInt               @id @default(autoincrement())
  tenantId         BigInt
  invoiceNumber    String               @unique @db.VarChar(50)
  externalId       String?              @unique @db.VarChar(100)
  amount           Decimal              @db.Decimal(15, 2)
  currency         String               @default("BRL") @db.VarChar(3)
  periodStart      DateTime
  periodEnd        DateTime
  issueDate        DateTime             @default(now())
  dueDate          DateTime
  paidAt           DateTime?
  status           TenantInvoice_status @default(PENDING)
  description      String?              @db.Text
  lineItems        Json?
  paymentMethod    String?              @db.VarChar(50)
  paymentReference String?              @db.VarChar(100)
  invoiceUrl       String?              @db.Text
  receiptUrl       String?              @db.Text
  metadata         Json?
  createdAt        DateTime             @default(now())
  updatedAt DateTime @updatedAt
  Tenant           Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([periodStart, periodEnd])
  @@index([status])
  @@index([tenantId])
}

model ThemeColors {
  id              BigInt        @id @default(autoincrement())
  themeSettingsId BigInt        @unique
  light           Json?
  dark            Json?
  ThemeSettings   ThemeSettings @relation(fields: [themeSettingsId], references: [id], onDelete: Cascade)
}

model ThemeSettings {
  id                 BigInt            @id @default(autoincrement())
  name               String            @unique
  platformSettingsId BigInt?
  ThemeColors        ThemeColors?
  PlatformSettings   PlatformSettings? @relation(fields: [platformSettingsId], references: [id])

  @@index([platformSettingsId])
}

model User {
  id                                               BigInt                  @id @default(autoincrement())
  email                                            String                  @unique
  password                                         String?                 @db.Text
  fullName                                         String?                 @db.Text
  cpf                                              String?                 @db.Text
  rgNumber                                         String?                 @db.Text
  rgIssuer                                         String?                 @db.Text
  rgIssueDate                                      DateTime?
  dateOfBirth                                      DateTime?
  cellPhone                                        String?                 @db.Text
  homePhone                                        String?                 @db.Text
  gender                                           String?                 @db.Text
  profession                                       String?                 @db.Text
  nationality                                      String?                 @db.Text
  maritalStatus                                    String?                 @db.Text
  propertyRegime                                   String?                 @db.Text
  spouseName                                       String?                 @db.Text
  spouseCpf                                        String?                 @db.Text
  zipCode                                          String?                 @db.Text
  street                                           String?                 @db.Text
  number                                           String?                 @db.Text
  complement                                       String?                 @db.Text
  neighborhood                                     String?                 @db.Text
  city                                             String?                 @db.Text
  state                                            String?                 @db.Text
  avatarUrl                                        String?                 @db.Text
  dataAiHint                                       String?                 @db.Text
  habilitationStatus                               User_habilitationStatus @default(PENDING_DOCUMENTS)
  accountType                                      User_accountType        @default(PHYSICAL)
  badges                                           Json?
  razaoSocial                                      String?                 @db.Text
  cnpj                                             String?                 @db.Text
  inscricaoEstadual                                String?                 @db.Text
  website                                          String?                 @db.Text
  responsibleName                                  String?                 @db.Text
  responsibleCpf                                   String?                 @db.Text
  optInMarketing                                   Boolean?                @default(false)
  createdAt                                        DateTime                @default(now())
  updatedAt DateTime @updatedAt
  Asset                                            Asset[]
  AuctionHabilitation                              AuctionHabilitation[]
  Auctioneer                                       Auctioneer?
  Bid                                              Bid[]
  Lot                                              Lot[]
  LotQuestion                                      LotQuestion[]
  LotRisk                                          LotRisk[]
  MediaItem                                        MediaItem[]
  Notification                                     Notification[]
  Report                                           Report[]
  Review                                           Review[]
  Seller                                           Seller?
  UserDocument                                     UserDocument[]
  UserLotMaxBid                                    UserLotMaxBid[]
  UserWin                                          UserWin[]
  UsersOnRoles                                     UsersOnRoles[]
  UsersOnTenants                                   UserOnTenant[]
  AuditLog                                       AuditLog[]
  BidderProfile                                  BidderProfile?
  FormSubmission                                 FormSubmission[]
  itsm_attachments                                 itsm_attachments[]
  ITSM_ChatLog                                   ITSM_ChatLog[]
  itsm_messages                                    itsm_messages[]
  itsm_query_logs                                  itsm_query_logs[]
  itsm_tickets_itsm_tickets_assignedToUserIdToUser ITSM_Ticket[]          @relation("itsm_tickets_assignedToUserIdToUser")
  itsm_tickets_itsm_tickets_userIdToUser           ITSM_Ticket[]          @relation("itsm_tickets_userIdToUser")
}

model UserDocument {
  id              BigInt              @id @default(autoincrement())
  status          UserDocument_status @default(PENDING_ANALYSIS)
  createdAt       DateTime            @default(now())
  updatedAt DateTime @updatedAt
  userId          BigInt
  documentTypeId  BigInt
  fileName        String?
  fileUrl         String
  rejectionReason String?
  tenantId        BigInt?
  DocumentType    DocumentType        @relation(fields: [documentTypeId], references: [id], onDelete: Cascade)
  Tenant          Tenant?             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, documentTypeId])
  @@index([documentTypeId])
  @@index([tenantId])
}

model UserLotMaxBid {
  id        BigInt    @id @default(autoincrement())
  userId    BigInt
  lotId     BigInt
  maxAmount Decimal   @db.Decimal(15, 2)
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  tenantId  BigInt
  updatedAt DateTime?
  Lot       Lot       @relation(fields: [lotId], references: [id], onDelete: Cascade)
  Tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lotId])
  @@index([lotId])
  @@index([tenantId])
}

model UserWin {
  id                 BigInt                @id @default(autoincrement())
  lotId              BigInt                @unique
  userId             BigInt
  winningBidAmount   Decimal               @db.Decimal(15, 2)
  winDate            DateTime              @default(now())
  paymentStatus      UserWin_paymentStatus @default(PENDENTE)
  retrievalStatus    String                @default("PENDENTE")
  invoiceUrl         String?
  tenantId           BigInt
  InstallmentPayment InstallmentPayment[]
  Lot                Lot                   @relation(fields: [lotId], references: [id])
  Tenant             Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User               User                  @relation(fields: [userId], references: [id])

  @@index([tenantId])
  @@index([userId])
}

model UsersOnRoles {
  userId     BigInt
  roleId     BigInt
  assignedAt DateTime @default(now())
  assignedBy String
  Role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@index([roleId])
}

model UserOnTenant {
  userId     BigInt
  tenantId   BigInt
  assignedAt DateTime @default(now())
  assignedBy String?
  Tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, tenantId])
  @@index([tenantId])
  @@map("UsersOnTenants")
}

model VariableIncrementRule {
  id                 BigInt           @id @default(autoincrement())
  platformSettingsId BigInt
  from               Float
  to                 Float?
  increment          Float
  PlatformSettings   PlatformSettings @relation(fields: [platformSettingsId], references: [id], onDelete: Cascade)

  @@index([platformSettingsId])
}

model VehicleMake {
  id           BigInt         @id @default(autoincrement())
  name         String         @unique
  slug         String         @unique
  VehicleModel VehicleModel[]
}

model VehicleModel {
  id          BigInt      @id @default(autoincrement())
  name        String
  slug        String
  makeId      BigInt
  VehicleMake VehicleMake @relation(fields: [makeId], references: [id], onDelete: Cascade)

  @@unique([makeId, name])
  @@index([slug])
}

model AuditLog {
  id         BigInt            @id @default(autoincrement())
  tenantId   BigInt?
  userId     BigInt
  entityType String
  entityId   BigInt
  action     audit_logs_action
  changes    Json?

  // Observability & Audit 360 Fields
  traceId       String?   @map("trace_id") @db.VarChar(255) 
  oldValues     Json?     @map("old_values")
  newValues     Json?     @map("new_values")
  changedFields String?   @map("changed_fields") @db.Text

  metadata   Json?
  ipAddress  String?           @db.Text
  userAgent  String?           @db.Text
  location   String?           @db.Text
  timestamp  DateTime          @default(now())
  Tenant     Tenant?           @relation(fields: [tenantId], references: [id])
  User       User              @relation(fields: [userId], references: [id])

  @@index([action])
  @@index([tenantId, entityType, entityId])
  @@index([timestamp])
  @@index([userId])
  @@index([traceId])
}

model BidderNotification {
  id              BigInt                    @id @default(autoincrement())
  bidderId        BigInt
  type            bidder_notifications_type
  title           String
  message         String
  data            Json?
  isRead          Boolean                   @default(false)
  readAt          DateTime?
  createdAt       DateTime                  @default(now())
  tenantId        BigInt?
  BidderProfile BidderProfile           @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  Tenant          Tenant?                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([bidderId])
  @@index([tenantId])
}

model BidderProfile {
  id                    BigInt                         @id @default(autoincrement())
  userId                BigInt                         @unique
  fullName              String?
  cpf                   String?                        @unique
  phone                 String?
  dateOfBirth           DateTime?
  address               String?
  city                  String?
  state                 String?
  zipCode               String?
  documentStatus        bidder_profiles_documentStatus @default(PENDING)
  submittedDocuments    Json?
  emailNotifications    Boolean                        @default(true)
  smsNotifications      Boolean                        @default(false)
  isActive              Boolean                        @default(true)
  createdAt             DateTime                       @default(now())
  updatedAt DateTime @updatedAt
  tenantId              BigInt?
  BidderNotification  BidderNotification[]
  Tenant                Tenant?                        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User                  User                           @relation(fields: [userId], references: [id], onDelete: Cascade)
  ParticipationHistory ParticipationHistory[]
  PaymentMethod       PaymentMethod[]
  WonLot              WonLot[]

  @@index([tenantId])
}

model EntityViewMetrics {
  id             BigInt    @id @default(autoincrement())
  entityType     String
  entityId       BigInt
  entityPublicId String?
  tenantId       BigInt?
  totalViews     Int       @default(0)
  uniqueViews    Int       @default(0)
  viewsLast24h   Int       @default(0)
  viewsLast7d    Int       @default(0)
  viewsLast30d   Int       @default(0)
  sharesCount    Int       @default(0)
  favoritesCount Int       @default(0)
  lastViewedAt   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt DateTime @updatedAt

  @@unique([entityType, entityId])
  @@index([entityPublicId])
  @@index([tenantId])
  @@index([totalViews])
  @@index([viewsLast24h])
}

model FormSubmission {
  id               BigInt                  @id @default(autoincrement())
  tenantId         BigInt?
  userId           BigInt
  formType         String
  entityId         BigInt?
  status           form_submissions_status
  validationScore  Int
  data             Json
  validationErrors Json?
  submittedAt      DateTime                @default(now())
  completedAt      DateTime?
  Tenant           Tenant?                 @relation(fields: [tenantId], references: [id])
  User             User                    @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([tenantId, formType])
  @@index([userId])
}

model itsm_attachments {
  id           BigInt       @id @default(autoincrement())
  ticketId     BigInt
  fileName     String
  fileUrl      String       @db.Text
  fileSize     Int?
  mimeType     String?
  uploadedBy   BigInt
  createdAt    DateTime     @default(now())
  ITSM_Ticket ITSM_Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  User         User         @relation(fields: [uploadedBy], references: [id])

  @@index([ticketId])
  @@index([uploadedBy])
}

model ITSM_ChatLog {
  id            BigInt        @id @default(autoincrement())
  ticketId      BigInt?
  userId        BigInt
  messages      Json
  sessionId     String?
  context       Json?
  wasHelpful    Boolean?
  ticketCreated Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt DateTime @updatedAt
  tenantId      BigInt?
  Tenant        Tenant?       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ITSM_Ticket  ITSM_Ticket? @relation(fields: [ticketId], references: [id])
  User          User          @relation(fields: [userId], references: [id])

  @@index([sessionId])
  @@index([tenantId])
  @@index([ticketId])
  @@index([userId])
}

model itsm_messages {
  id           BigInt       @id @default(autoincrement())
  ticketId     BigInt
  userId       BigInt
  message      String       @db.Text
  isInternal   Boolean      @default(false)
  createdAt    DateTime     @default(now())
  ITSM_Ticket ITSM_Ticket @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  User         User         @relation(fields: [userId], references: [id])

  @@index([ticketId])
  @@index([userId])
}

model itsm_query_logs {
  id           BigInt   @id @default(autoincrement())
  query        String   @db.Text
  duration     Int
  success      Boolean
  errorMessage String?  @db.Text
  userId       BigInt?
  endpoint     String?
  method       String?
  ipAddress    String?
  timestamp    DateTime @default(now())
  User         User?    @relation(fields: [userId], references: [id])

  @@index([success])
  @@index([timestamp])
  @@index([userId])
}

model ITSM_Ticket {
  id                                       BigInt                @id @default(autoincrement())
  publicId                                 String                @unique
  userId                                   BigInt
  title                                    String
  description                              String                @db.Text
  status                                   itsm_tickets_status   @default(ABERTO)
  priority                                 itsm_tickets_priority @default(MEDIA)
  category                                 itsm_tickets_category @default(OUTRO)
  userSnapshot                             Json?
  userAgent                                String?               @db.Text
  browserInfo                              String?               @db.Text
  screenSize                               String?
  pageUrl                                  String?               @db.Text
  errorLogs                                Json?
  assignedToUserId                         BigInt?
  createdAt                                DateTime              @default(now())
  updatedAt DateTime @updatedAt
  resolvedAt                               DateTime?
  closedAt                                 DateTime?
  tenantId                                 BigInt?
  itsm_attachments                         itsm_attachments[]
  ITSM_ChatLog                           ITSM_ChatLog[]
  itsm_messages                            itsm_messages[]
  User_itsm_tickets_assignedToUserIdToUser User?                 @relation("itsm_tickets_assignedToUserIdToUser", fields: [assignedToUserId], references: [id])
  Tenant                                   Tenant?               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  User_itsm_tickets_userIdToUser           User                  @relation("itsm_tickets_userIdToUser", fields: [userId], references: [id])

  @@index([assignedToUserId])
  @@index([priority])
  @@index([status])
  @@index([tenantId])
  @@index([userId])
}

model ParticipationHistory {
  id              BigInt                       @id @default(autoincrement())
  bidderId        BigInt
  lotId           BigInt
  auctionId       BigInt
  title           String
  auctionName     String
  maxBid          Decimal?                     @db.Decimal(10, 2)
  finalBid        Decimal?                     @db.Decimal(10, 2)
  result          participation_history_result
  participatedAt  DateTime                     @default(now())
  bidCount        Int                          @default(0)
  createdAt       DateTime                     @default(now())
  tenantId        BigInt
  BidderProfile BidderProfile              @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  Tenant          Tenant                       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([bidderId])
  @@index([tenantId])
}

model PaymentMethod {
  id              BigInt               @id @default(autoincrement())
  bidderId        BigInt
  type            PaymentMethod_type
  isDefault       Boolean              @default(false)
  cardLast4       String?
  cardBrand       String?
  cardToken       String?
  pixKey          String?
  pixKeyType      String?
  isActive        Boolean              @default(true)
  expiresAt       DateTime?
  createdAt       DateTime             @default(now())
  updatedAt DateTime @updatedAt
  tenantId        BigInt?
  BidderProfile BidderProfile      @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  Tenant          Tenant?              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([bidderId])
  @@index([tenantId])
}

model validation_rules {
  id           BigInt                    @id @default(autoincrement())
  entityType   String
  fieldName    String
  ruleType     validation_rules_ruleType
  config       Json
  isRequired   Boolean                   @default(false)
  errorMessage String                    @db.Text
  severity     validation_rules_severity @default(ERROR)
  isActive     Boolean                   @default(true)
  createdAt    DateTime                  @default(now())
  updatedAt DateTime @updatedAt

  @@unique([entityType, fieldName, ruleType])
  @@index([entityType])
}

model VisitorEvent {
  id               BigInt                   @id @default(autoincrement())
  eventId          String                   @unique
  visitorId        BigInt
  sessionId        BigInt
  eventType        VisitorEvent_eventType
  entityType       String?
  entityId         BigInt?
  entityPublicId   String?
  metadata         Json?
  pageUrl          String?                  @db.Text
  timestamp        DateTime                 @default(now())
  VisitorSession VisitorSession         @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  Visitor         Visitor                 @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([entityPublicId])
  @@index([entityType, entityId])
  @@index([eventType])
  @@index([sessionId])
  @@index([timestamp])
  @@index([visitorId])
}

model VisitorSession {
  id             BigInt           @id @default(autoincrement())
  sessionId      String           @unique
  visitorId      BigInt
  startedAt      DateTime         @default(now())
  endedAt        DateTime?
  lastActivityAt DateTime         @default(now())
  userAgent      String?          @db.Text
  ipAddress      String?          @db.Text
  referrer       String?          @db.Text
  utmSource      String?
  utmMedium      String?
  utmCampaign    String?
  pageViews      Int              @default(0)
  eventsCount    Int              @default(0)
  duration       Int?
  VisitorEvent VisitorEvent[]
  Visitor       Visitor         @relation(fields: [visitorId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([startedAt])
  @@index([visitorId])
}

model Visitor {
  id               BigInt             @id @default(autoincrement())
  visitorId        String             @unique
  userId           BigInt?
  firstVisitAt     DateTime           @default(now())
  lastVisitAt      DateTime           @default(now())
  firstUserAgent   String?            @db.Text
  firstIpAddress   String?            @db.Text
  firstReferrer    String?            @db.Text
  country          String?
  region           String?
  city             String?
  deviceType       String?
  browser          String?
  os               String?
  totalVisits      Int                @default(1)
  totalPageViews   Int                @default(0)
  totalEvents      Int                @default(0)
  createdAt        DateTime           @default(now())
  updatedAt DateTime @updatedAt
  VisitorEvent   VisitorEvent[]
  VisitorSession VisitorSession[]

  @@index([country])
  @@index([lastVisitAt])
  @@index([userId])
}

model WonLot {
  id              BigInt                  @id @default(autoincrement())
  bidderId        BigInt
  lotId           BigInt
  auctionId       BigInt
  title           String
  finalBid        Decimal                 @db.Decimal(10, 2)
  wonAt           DateTime                @default(now())
  status          won_lots_status         @default(WON)
  paymentStatus   won_lots_paymentStatus  @default(PENDENTE)
  totalAmount     Decimal                 @db.Decimal(10, 2)
  paidAmount      Decimal                 @default(0.00) @db.Decimal(10, 2)
  dueDate         DateTime?
  deliveryStatus  won_lots_deliveryStatus @default(PENDING)
  trackingCode    String?
  invoiceUrl      String?
  receiptUrl      String?
  createdAt       DateTime                @default(now())
  updatedAt DateTime @updatedAt
  tenantId        BigInt
  BidderProfile BidderProfile         @relation(fields: [bidderId], references: [id], onDelete: Cascade)
  Tenant          Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([bidderId])
  @@index([tenantId])
}

// =============================================================================
// ENUMS - IdÃªnticos ao schema MySQL (compatÃ­veis entre ambos os bancos)
// =============================================================================

enum UserDocument_status {
  NOT_SENT
  SUBMITTED
  PENDING_ANALYSIS
  APPROVED
  REJECTED
}

enum bidder_notifications_type {
  AUCTION_WON
  PAYMENT_DUE
  PAYMENT_OVERDUE
  DOCUMENT_APPROVED
  DOCUMENT_REJECTED
  DELIVERY_UPDATE
  AUCTION_ENDING
  SYSTEM_UPDATE
}

enum DocumentTemplate_type {
  WINNING_BID_TERM
  EVALUATION_REPORT
  AUCTION_CERTIFICATE
}

enum LotRisk_riskType {
  OCUPACAO_IRREGULAR
  PENHORA
  INSCRICAO_DIVIDA
  RESTRICAO_AMBIENTAL
  DOENCA_ACARAJADO
  OUTRO
}

enum PaymentMethod_type {
  CREDIT_CARD
  DEBIT_CARD
  PIX
  BOLETO
  BANK_TRANSFER
}

enum JudicialParty_partyType {
  AUTOR
  REU
  ADVOGADO_AUTOR
  ADVOGADO_REU
  JUIZ
  ESCRIVAO
  PERITO
  ADMINISTRADOR_JUDICIAL
  TERCEIRO_INTERESSADO
  OUTRO
}

enum LotRisk_riskLevel {
  BAIXO
  MEDIO
  ALTO
  CRITICO
}

enum validation_rules_ruleType {
  REQUIRED
  MIN_LENGTH
  MAX_LENGTH
  PATTERN
  MIN_VALUE
  MAX_VALUE
  DATE_RANGE
  FILE_TYPE
  FILE_SIZE
  CUSTOM
}

enum AssetStatus {
  CADASTRO
  DISPONIVEL
  LOTEADO
  VENDIDO
  REMOVIDO
  INATIVADO
}

enum DirectSaleOffer_offerType {
  BUY_NOW
  ACCEPTS_PROPOSALS
}

enum Tenant_resolutionStrategy {
  SUBDOMAIN
  PATH
  CUSTOM_DOMAIN
}

enum VisitorEvent_eventType {
  PAGE_VIEW
  LOT_VIEW
  AUCTION_VIEW
  SEARCH
  FILTER_APPLIED
  BID_CLICK
  SHARE_CLICK
  FAVORITE_ADD
  FAVORITE_REMOVE
  DOCUMENT_DOWNLOAD
  IMAGE_VIEW
  VIDEO_PLAY
  CONTACT_CLICK
  HABILITATION_START
}

enum AuctionStatus {
  RASCUNHO
  EM_VALIDACAO
  EM_AJUSTE
  EM_PREPARACAO
  EM_BREVE
  ABERTO
  ABERTO_PARA_LANCES
  EM_PREGAO
  ENCERRADO
  FINALIZADO
  CANCELADO
  SUSPENSO
}

enum AuctionStage_status {
  RASCUNHO
  AGENDADO
  EM_ANDAMENTO
  SUSPENSO
  CONCLUIDO
  CANCELADO
  AGUARDANDO_INICIO
  ABERTO
  FECHADO
}

enum audit_logs_action {
  CREATE
  UPDATE
  DELETE
  SOFT_DELETE
  RESTORE
  PUBLISH
  UNPUBLISH
  APPROVE
  REJECT
  EXPORT
  IMPORT
}

enum form_submissions_status {
  DRAFT
  VALIDATING
  VALID
  INVALID
  SUBMITTED
  FAILED
}

enum itsm_tickets_status {
  ABERTO
  EM_ANDAMENTO
  AGUARDANDO_USUARIO
  RESOLVIDO
  FECHADO
  CANCELADO
}

enum UserWin_paymentStatus {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  REEMBOLSADO
  CANCELADO
  ATRASADO
}

enum itsm_tickets_priority {
  BAIXA
  MEDIA
  ALTA
  CRITICA
}

enum DirectSaleOffer_status {
  ACTIVE
  PENDING_APPROVAL
  SOLD
  EXPIRED
  RASCUNHO
}

enum InstallmentPayment_status {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  REEMBOLSADO
  CANCELADO
  ATRASADO
}

enum itsm_tickets_category {
  TECNICO
  FUNCIONAL
  DUVIDA
  SUGESTAO
  BUG
  OUTRO
}

enum TenantStatus {
  PENDING
  TRIAL
  ACTIVE
  SUSPENDED
  CANCELLED
  EXPIRED
}

enum validation_rules_severity {
  ERROR
  WARNING
  INFO
}

enum won_lots_status {
  WON
  PAID
  DELIVERED
  CANCELLED
}

enum participation_history_result {
  WON
  LOST
  WITHDRAWN
}

enum won_lots_paymentStatus {
  PENDENTE
  PROCESSANDO
  PAGO
  FALHOU
  REEMBOLSADO
  CANCELADO
  ATRASADO
}

enum bidder_profiles_documentStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  EXPIRED
}

enum LotStatus {
  RASCUNHO
  AGUARDANDO
  EM_BREVE
  ABERTO_PARA_LANCES
  EM_PREGAO
  ENCERRADO
  VENDIDO
  NAO_VENDIDO
  RELISTADO
  CANCELADO
  RETIRADO
}

enum BidStatus {
  ATIVO
  CANCELADO
  VENCEDOR
  EXPIRADO
}

enum TenantInvoice_status {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum Auction_auctionType {
  JUDICIAL
  EXTRAJUDICIAL
  PARTICULAR
  TOMADA_DE_PRECOS
  VENDA_DIRETA
}

enum won_lots_deliveryStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  FAILED
}

enum Auction_auctionMethod {
  STANDARD
  DUTCH
  SILENT
}

enum JudicialProcess_actionType {
  USUCAPIAO
  REMOCAO
  HIPOTECA
  DESPEJO
  PENHORA
  COBRANCA
  INVENTARIO
  DIVORCIO
  OUTROS
}

enum Auction_participation {
  ONLINE
  PRESENCIAL
  HIBRIDO
}

enum User_habilitationStatus {
  PENDING_DOCUMENTS
  PENDING_ANALYSIS
  HABILITADO
  REJECTED_DOCUMENTS
  BLOCKED
}

enum User_accountType {
  PHYSICAL
  LEGAL
  DIRECT_SALE_CONSIGNOR
}

enum PlatformSettings_storageProvider {
  LOCAL
  FIREBASE
}

enum PlatformSettings_searchPaginationType {
  loadMore
  numberedPages
}

enum Asset_occupationStatus {
  OCCUPIED
  UNOCCUPIED
  UNCERTAIN
  SHARED_POSSESSION
}

// AUDIT & OBSERVABILITY 360
model AuditConfig {
  id        String   @id @default(uuid())
  entity    String   @unique
  enabled   Boolean  @default(true)
  fields    Json?
  createdAt DateTime @default(now())

  @@map("audit_configs")
}
