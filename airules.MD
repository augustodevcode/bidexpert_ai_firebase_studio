# AI Prototyper Rules

This document contains specific rules and guidelines for the AI prototyper to follow during development.

## 1. Database and Data Source Architecture

**Rule:** The application uses a dynamic **Adapter Pattern** for data access, managed by the `getDatabaseAdapter()` function in `src/lib/database/get-adapter.ts`. The active database system is determined by the `NEXT_PUBLIC_ACTIVE_DATABASE_SYSTEM` environment variable in the `.env` file. Do not bypass this adapter; all database operations must go through the functions exposed by the currently selected adapter.

**Rationale:** This pattern provides the flexibility to switch between different data sources (MySQL, PostgreSQL, Firestore, Sample Data) for development, testing, and production without changing the core application logic (services and controllers).

## 2. Schema and Migrations

**Rule:** For SQL databases (MySQL, PostgreSQL), the single source of truth for the database schema is `prisma/schema.prisma`. Any necessary schema changes must be made in this file. After modifying the schema, the Prisma client must be regenerated by running `prisma generate`, which is typically part of the `npm install` or `postinstall` script.

**Rationale:** Using Prisma as the schema definition tool ensures type safety and provides a consistent way to manage the database structure across different SQL environments.

## 3. MVC with Service Layer Architecture

**Rule:** The application's architecture is defined as **MVC (Model-View-Controller) with an intermediate Service Layer**. This structure is the standard for all future development. All new functionality must adhere to this pattern.
    - **Controllers** (Server Actions in `actions.ts` files) handle user input and API requests.
    - **Services** (`/services/*.ts`) contain the core business logic.
    - **Data Access** is handled exclusively by the `DatabaseAdapter` retrieved via `getDatabaseAdapter()`. Direct use of `PrismaClient` or other database drivers in services or controllers is forbidden.

**Rationale:** Maintaining a consistent architecture is crucial for the long-term scalability, maintainability, and testability of the project. This separation of concerns (Presentation, Business Logic, Data Access) makes the codebase cleaner and easier to manage.

## 4. Directory Structure

**Rule:** The Next.js application structure must follow the `src` directory convention. The main application routes must reside within `src/app`. **Under no circumstances should a nested `app` directory (e.g., `src/app/app`) or a root-level `app` directory be created.** Any such occurrence must be identified and corrected immediately by merging the files into `src/app` and removing the incorrect directory.

**Rationale:** A nested or misplaced `app` directory breaks Next.js's file-based routing system, leading to build failures and runtime errors. Maintaining the correct structure is critical for the application's stability.

## 5. HTML/CSS Naming Conventions

**Rule:** All new HTML elements created must have a `data-ai-id` attribute with a unique, human-readable, and contextually relevant name. This name should reflect the element's purpose or content. For example, a button to submit a login form should be `<Button data-ai-id="login-submit-button">`, and a container for a user's profile card should be `<div data-ai-id="user-profile-card">`.

**Rationale:** This convention is essential for the AI to reliably identify and manipulate specific UI elements, ensuring that future requests are executed precisely. It also aids in end-to-end testing and debugging.

## 6. Development Environment Information

**Rule:** During development (`NODE_ENV === 'development'`), the application footer must display key environment information. This includes the currently active database system (e.g., Firestore, MySQL), the logged-in user's email, and the active Firebase Project ID.

**Rationale:** This provides immediate, persistent context about the development environment, preventing confusion and aiding in debugging database or user-specific issues.
